<#include "/common/include1.html"/>
<@pageTheme mark="${config.optimize()?string('true', 'false')}">
<@header title="新增公司" bodyClass="white-bg"/>
<div class="wrapper wrapper-content ibox-content">
	<@from.from id="form-comp-add" class="form-horizontal">
	<@from.hidden name="type" value="0"/>
	<div class="form-group">
		<label class="col-sm-3 control-label "><span style="color: red; ">*</span>上级公司：</label>
		<div class="col-sm-8">
			<@from.treeselect id="parentId" name="parentId" boxTitle="选择上级公司" url="sys/comp/treeData?type=0"
			expandLevel="true" value="${comp.id}" labelValue="${comp.name?default('总公司')}" isParentIds="true"
			parenIdsValue="${comp.id}${(comp.parentIds == '1')?string('',',${comp.parentIds}')}"
			placeholder="请选择上级公司" required="true"/>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label"><span style="color: red; ">*</span>公司名称：</label>
		<div class="col-sm-8">
			<@from.input name="name" required="true"/>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label"><span style="color: red; ">*</span>公司全称：</label>
		<div class="col-sm-8">
			<@from.input name="fullName" required="true"/>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label "><span style="color: red; ">*</span>归属地区：</label>
		<div class="col-sm-8">
			<@from.treeselect id="areaId" name="areaIds" boxTitle="请选择管理地区" url="sys/area/treeData"
			checked="true" correlationId="parentId" placeholder="请选择管理地区"/>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label">显示排序：</label>
		<div class="col-sm-8">
			<input class="form-control" type="text" name="orderNum" required>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label"><span style="color: red; ">*</span><@ctx.i18n text = "状态"/>：</label>
		<div class="col-sm-8">
			<@from.radio name="status" dictType="sys_normal_disable"/>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label"><@ctx.i18n text = "备注"/>：</label>
		<div class="col-sm-8">
			<@from.textarea name="remark"/>
		</div>
	</div>
</div>
</@from.from>
<@footer>
<script type="text/javascript">
	var prefix = baseURL + "sys/comp";

	$("#form-comp-add").validate({
		onkeyup: false,
		rules:{
			name:{
				remote: {
					url: prefix + "/checkCompNameUnique",
					type: "POST",
					dataType: "html",
					data: {
						"parentId": function() {
							return $("input[name='parentId']").val();
						},
						"name" : function() {
							return opt.common.trim($("#name").val());
						}
					},
					dataFilter: function(data, type) {
						return opt.validate.unique(data);
					}
				}
			},
			orderNum:{
				digits:true
			}
		},
		messages: {
			"name": {
				remote: "已经存在"
			}
		},
		focusCleanup: true
	});

	function submitHandler() {
		if (opt.validate.form()) {
			// var options = {
			// 	id:'form-comp-add',
			// 	conversion:[ /*//需要转数据*/
			// 		{
			// 			name:'deptIdList',
			// 			value:'arr'
			// 		}
			// 	]
			// };
			// var data = opt.form.dataUp(options);
			// opt.operate.save(prefix + "/add", data);
			opt.operate.save(prefix + "/add", $('#form-comp-add').serialize());
		}
	}

	<#--/*部门管理-新增-选择父部门树*/-->
	<#--function selectCompTree() {-->
	<#--	var options = {-->
	<#--		title: '公司选择',-->
	<#--		width: "380",-->
	<#--		url: prefix + "/selectCompTree/" + $("#parentId").val(),-->
	<#--		callBack: doSubmit-->
	<#--	};-->
	<#--	opt.modal.openOptions(options);-->
	<#--}-->

	<#--function doSubmit(index, layero){-->
	<#--	var _v = $.tree.callBackTree(layero,index);-->
	<#--	$("#parentId").val(_v.id);-->
	<#--	$("#compName").val(_v.name);-->
	<#--	layer.close(index);-->
	<#--}-->

	<#--/*获取公司对应地区*/-->
	<#--function selectDeptTree(){-->
	<#--	var options = {-->
	<#--		title:"<@ctx.i18n text = "sys.select.dept"/>",-->
	<#--		width: "380",-->
	<#--		url: baseURL+'sys/dept/selectDeptTree',-->
	<#--		obj:{"id":$("#parentId").val(),"list":$("#deptId").val()},-->
	<#--		callBack: DeptDoSubmit-->
	<#--	};-->
	<#--	opt.modal.openOptions(options);-->
	<#--}-->
	<#--function DeptDoSubmit(index, layero){-->
	<#--	var _v = $.tree.callBackTree(layero,index);-->
	<#--	$("#deptId").val(_v.id);-->
	<#--	$("#deptName").val(_v.name);-->
	<#--	layer.close(index);-->
	<#--}-->
</script>
</@footer>
</@pageTheme>