/*!
 * Copyright (c) 2020-Now http://www.lixinfintech.com All rights reserved.
 *
 * 主页JS
 * @author ZhouHuan
 * @version 2020-02-10
 */
+function(a){function e(){void 0!==window.layui&&(layui.config({base:b.base}),layui.use(["navtab"],function(){b.element=layui.element,opt.variable.navtab=layui.navtab({elem:b.elem,closed:!1}),new d}))}var b={base:"statics/js/",elem:".larry-tab-box",element:null},c={"class":".sidebar-menu",treeview:".treeview"},d=function(){this._setUpListeners(),this._remember()};d.prototype._remember=function(){var e,f,g,h,i,j,k,l,m,n,o,c=opt.storage.get("_Tab"),d=location.hash;if("1"===c||"1"===_unlock){if(e=opt.storage.get("menu"),e&&""==d)for(e=JSON.parse(e),f=0;f<e.length;f++)a(".sidebar-menu").children(".treeview").each(function(){a(this).find("ul").length>0&&a(this).find("ul").children("li").each(function(){var b=a(this).children("a"),c=b.data("id"),d=b.children("span:first").text();c===e[f].id&&(e[f].title=d)})}),opt.navTabAdd(e[f])}else opt.storage.set("menu","");""!=d&&(g=d.substring(1,d.length).split("#"),h=g[0],i=a('a[data-url="'+h+'"][data-module="'+g[1]+'"]'),i.length>0?(k=i.data("url"),l=i.data("id"),m=i.data("module"),n=i.children("i:first").data("icon"),o=i.children("span:first").text(),j={href:k,icon:n,title:o,module:m,id:l}):("sys/user/profile/info"===h&&(j={href:"sys/user/profile/info",icon:"fa fa-address-card",title:a.i18n.prop("个人中心"),id:"-1",module:"_sysInfo"}),"sys/user/profile/password"===h&&(j={href:"sys/user/profile/password",icon:"fa fa-shield",title:a.i18n.prop("修改密码"),id:"-2",module:"_sysInfo"})),opt.storage.set("menu",""),opt.navTabAdd(j))},d.prototype.setIframeUrl=function(a,b){var c=window.location.href,d=c.substring(0,c.indexOf("#"));window.location.href=d+"#"+a+"#"+b},d.prototype.toggle=function(b){var h,i,j,k,l,d=b.children("a"),e=d.data("target"),f=d.data("url"),g=d.data("module");("_tab"===e||""==e||"_fullscreen"===e)&&(h=d.data("id"),i=d.children("i:first").data("icon"),j=d.children("span:first").text(),k={href:f,icon:i,title:j,module:g,id:h},opt.navTabAdd(k),"_fullscreen"==e&&(l=a('iframe[data-id="'+h+'"]'),l.fullScreen(!0))),"_blank"===e&&window.open(f),"_alert"===e&&(i=d.children("i:first").data("icon"),j=d.children("span:first").text(),opt.layer.open({type:2,maxmin:!0,shadeClose:!0,title:'<i class="'+i+'"></i>&nbsp;'+j,area:[a(window).width()-100+"px",a(window).height()-100+"px"],content:f}))},d.prototype._tabSwitch=function(){var c=this;b.element.on("tab(main-tab)",function(){var d,e,f,g;opt.scrollToTab(this),d=a('iframe[data-id="'+a(this).attr("lay-id")+'"]'),e=d.attr("src"),"main"!=e&&16!=(a(this).attr("lay-id")+"").length&&c.setIframeUrl(e,d.attr("data-module")),f=a(this).attr("lay-id"),g=a(this).children("em").data("module"),"0"!==f&&"_sysInfo"!==g&&(a("#leftMenu > ul").addClass("hide"),a("#topMenu li").each(function(){a(this).children("a").data("code")===g?a(this).addClass("active"):a(this).removeClass("active")}),a("#leftMenu-"+g).removeClass("hide"),a("#leftMenu-"+g).children(".treeview").each(function(){a(this).removeClass("menu-open"),a(this).find("ul").length>0&&(a(this).find("ul").css("display","none"),a(this).find("ul").children("li").each(function(){var b=a(this).children("a");0!=f&&b.data("id")==f?(a(this).parent(".treeview-menu").parent(".treeview").addClass("menu-open"),a(this).parent(".treeview-menu").css("display","block"),a(this).addClass("active")):a(this).removeClass("active")}))})),a(this).attr("lay-id")===opt.variable._tabIndex+""?opt.variable._tabIndex=a(this).attr("lay-id"):("1"===opt.storage.get("_tabRef")&&(d.attr("src",e).ready(),opt.block(".content-wrapper","数据加载中，请稍后..."),d.attr("src",e).on("load",function(){setTimeout(function(){opt.unblock(".content-wrapper")},50)})),opt.variable._tabIndex=a(this).attr("lay-id"))})},d.prototype._setUpListeners=function(){var b=this;a(c.class).children(c.treeview).each(function(){a(this).find("ul").length>0&&a(this).find("ul").children("li").each(function(){a(this).on("click",function(c){b.toggle(a(this),c)})})}),b._tabSwitch()},a.fn.menu=e,a.fn.menu.Constructor=d,a(function(){e()})}(jQuery),$(function(){$.contextMenu({selector:".layui-tab-card>.layui-tab-title li",trigger:"right",autoHide:!0,items:{refresh:{name:$.i18n.prop("刷新当前"),icon:"fa-refresh",callback:function(){var c,d;$(this).hasClass("layui-this")||navToTab($(this).attr("lay-id")),c=$('iframe[data-id="'+$(this).attr("lay-id")+'"]'),d=c.attr("src"),c.attr("src",d).ready(),window.opt.block(".content-wrapper","数据加载中，请稍后..."),c.attr("src",d).on("load",function(){setTimeout(function(){window.opt.unblock(".content-wrapper")},50)})}},close_current:{name:$.i18n.prop("关闭当前"),icon:"fa-close",callback:function(a,b){0!=$(this).attr("lay-id")&&b.$trigger.find("i").trigger("click")}},close_other:{name:$.i18n.prop("关闭其他"),icon:"fa-window-close-o",callback:function(){$(this).hasClass("layui-this")||navToTab($(this).attr("lay-id")),$(".layui-tab-title li").each(function(){return 0==$(this).attr("lay-id")||$(this).hasClass("layui-this")?void 0:($(this).children('i.layui-tab-close[data-id="'+$(this).attr("lay-id")+'"]').trigger("click"),void 0)}),window.opt.scrollToTab(this)}},close_all:{name:$.i18n.prop("关闭全部"),icon:"fa-window-close",callback:function(){$(".layui-tab-title li").length>1&&$(".layui-tab-title li").each(function(){0!=$(this).attr("lay-id")&&$(this).children('i.layui-tab-close[data-id="'+$(this).attr("lay-id")+'"]').trigger("click")})}},step1:"---------",close_left:{name:$.i18n.prop("关闭左侧"),icon:"fa-reply",callback:function(){$(this).hasClass("layui-this")||navToTab($(this).attr("lay-id")),this.prevAll("li").not(":last").each(function(){$(this).children('i.layui-tab-close[data-id="'+$(this).attr("lay-id")+'"]').trigger("click")}),window.opt.scrollToTab(this)}},close_right:{name:$.i18n.prop("关闭右侧"),icon:"fa-share",callback:function(){$(this).hasClass("layui-this")||navToTab($(this).attr("lay-id")),this.nextAll("li").each(function(){$(this).children('i.layui-tab-close[data-id="'+$(this).attr("lay-id")+'"]').trigger("click")}),window.opt.scrollToTab(this)}},step:"---------",full:{name:$.i18n.prop("全屏显示"),icon:"fa-arrows-alt",callback:function(){$(this).hasClass("layui-this")||window.opt.navToTab($(this).attr("lay-id"));var c=$('iframe[data-id="'+$(this).attr("lay-id")+'"]');c.fullScreen(!0)}},open:{name:$.i18n.prop("新窗口打开"),icon:"fa-link",callback:function(){var c=$('iframe[data-id="'+$(this).attr("lay-id")+'"]');window.open(c.attr("src"))}}}})}),$(function(){var a,b;$(window).on("load",function(){setTimeout(function(){opt.unblock(window)},10)}),$("#form-user-updatePass").validate({rules:{newPassword:{required:!0,minlength:6,maxlength:15}},focusCleanup:!0}),$('[click-id="userInfo"]').each(function(){$(this).on("click",function(){var a={href:"sys/user/profile/info",icon:"fa fa-address-card",title:$.i18n.prop("个人中心"),id:"-1",module:"_sysInfo"};opt.navTabAdd(a)})}),$("#switchSkin").on("click",function(){opt.layer.open({type:2,shadeClose:!0,title:$.i18n.prop("切换主题"),area:["530px","386px"],content:["sys/switchSkin","no"]})}),$("#updatePassword").on("click",function(){opt.layer.open({type:1,title:$.i18n.prop("修改密码"),area:["550px","280px"],shadeClose:!0,content:jQuery("#passwordLayer"),btn:[$.i18n.prop("确定"),$.i18n.prop("取消")],btn1:function(a){if($("#form-user-updatePass").validate().form()){var b=$("#form-user-updatePass").serializeArray();$.ajax({type:"POST",url:"sys/user/updatePass",data:b,dataType:"json",success:function(b){0==b.code?(opt.layer.close(a),opt.layer.alert("修改成功",function(){location.reload()})):opt.error(b.msg)}})}}})}),$('[click-id="logout"]').each(function(){$(this).on("click",function(){opt.layer.confirm($.i18n.prop("确定要退出系统吗?"),{btn:[$.i18n.prop("确定"),$.i18n.prop("取消")],title:$.i18n.prop("提示")},function(){window.location.href="logout"})})}),$("#scrollTabLeft").on("click",opt.scrollTabLeft),$("#scrollTabRight").on("click",opt.scrollTabRight),$("#fullScreen").on("click",function(){$(document).toggleFullScreen()}),$("#lockOs").on("click",function(){window.location.href=baseURL+"/Account/Lock?"+Math.random()}),$('[data-toggle="control-sidebar"]').controlSidebar(),$('[data-toggle="push-menu"]').pushMenu(),opt.variable.pushMenu=$('[data-toggle="push-menu"]').data("lte.pushmenu"),a=$('[data-toggle="control-sidebar"]').data("lte.controlsidebar"),b=$("body").data("lte.layout"),$(window).on("load",function(){opt.variable.pushMenu=$('[data-toggle="push-menu"]').data("lte.pushmenu"),a=$('[data-toggle="control-sidebar"]').data("lte.controlsidebar"),b=$("body").data("lte.layout")})}),+function(){opt.block(window,"数据加载中，请稍后...")}();