/*!
 * Copyright (c) 2020-Now http://www.j2eefast.com All rights reserved.
 *
 * navtab 定义Tab
 * @author ZhouHuan
 * @data 2020-02-20
 * @version 1.0.10
 */
layui.define(["element"],function(c){var e=layui.element,d=layui.jquery,f=parent.layer===undefined?layui.layer:parent.layer,h="navtab",b=0,i=function(){this.config={elem:undefined,closed:true}};var a={};i.prototype.set=function(j){var k=this;d.extend(true,k.config,j);return k};i.prototype.init=function(){var m=this;var k=m.config;if(typeof(k.elem)!=="string"&&typeof(k.elem)!=="object"){f.alert("Tab选项卡错误提示: elem参数未定义或设置出错，具体设置格式请参考文档API.")}var l;if(typeof(k.elem)==="string"){l=d(""+k.elem+"")}if(typeof(k.elem)==="object"){l=k.elem}if(l.length===0){f.alert("Tab选项卡错误提示:找不到elem参数配置的容器，请检查.")}var j=l.attr("lay-filter");if(j===undefined||j===""){f.alert("Tab选项卡错误提示:请为elem容器设置一个lay-filter过滤器")}k.elem=l;a.titleBox=l.children("ul.layui-tab-title");a.contentBox=l.children("div.layui-tab-content");a.tabFilter=j;return m};i.prototype.exists=function(n,k,l){var m=a.titleBox===undefined?this.init():this,j=-1;a.titleBox.find("li").each(function(p,q){var o=d(this).children("em");if((d(this).attr("lay-id")==n||o.attr("data-url")==k)&&l==o.attr("data-module")){j=d(this).attr("lay-id")}});return j};i.prototype.tabAdd=function(n){var p=this;var j=p.exists(n.id,n.href,n.module);if(j===-1){opt.block("数据加载中，请稍后...","#content-main");var l='<iframe width="100%" height="100%" src="'+n.href+'" data-id="'+n.id+'" data-module="'+n.module+'" class="larry-iframe"></iframe>';var o="";if(typeof(n.icon)!=="undefined"){o+='<i class="'+n.icon+'"></i>'}if(typeof(n.panel)!=="undefined"){o+='<em data-url="'+n.href+'" panel-id="'+n.panel+'"'}else{o+='<em data-url="'+n.href+'"'}if(typeof(n.module)!=="undefined"){o+=' data-module="'+n.module+'"'}o+='title="'+n.title+'">&nbsp;'+(n.title.length>12?(n.title.substr(0,12)+"..."):n.title)+"</em>";if(n.id!=="0"){o+='<i class="fa fa-times-circle-o layui-tab-close" data-id="'+n.id+'"></i>'}e.tabAdd(a.tabFilter,{title:o,content:l,id:n.id});opt.variable._tabIndex=n.id;d("#content-main .layui-tab-item").css("height",d(window).height()-d(".main-footer").outerHeight()-d(".main-header").outerHeight()-40);a.titleBox.find("li").children('i.layui-tab-close[data-id="'+n.id+'"]').on("click",function(){var s=opt.storage.get("menu");if(s){s=JSON.parse(s);for(var u=0;u<s.length;u++){if(s[u].id==d(this).attr("data-id")){s.splice(u,1)}}opt.storage.set("menu",JSON.stringify(s))}var q=false,v;if(a.titleBox.find('li[lay-id="'+d(this).attr("data-id")+'"]').children("em").attr("panel-id")!="undefined"){q=true;v=a.titleBox.find('li[lay-id="'+d(this).attr("data-id")+'"]').children("em").attr("panel-id")}var t=a.titleBox.find('li[lay-id="'+d(this).attr("data-id")+'"]').prev();e.tabDelete(a.tabFilter,d(this).attr("data-id")).init();var x=true,y=true;a.titleBox.find("li").each(function(){if(d(this).hasClass("layui-this")){x=false}if(q){if(d(this).attr("lay-id")==v){y=false}}});if(!y){e.tabChange(a.tabFilter,v);try{var r=d('iframe[data-id="'+v+'"]')[0].contentWindow;if(r.opt.table.options.type==opt.variable.table_type.bootstrapTable){r.$.table.refresh()}else{if(r.opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){r.$.treeTable.refresh()}}}catch(w){}}else{if(x){e.tabChange(a.tabFilter,t.attr("lay-id"))}}});a.titleBox.find('li[lay-id="'+n.id+'"]').on("dblclick",function(){d(this).children('i.layui-tab-close[data-id="'+d(this).attr("lay-id")+'"]').trigger("click")});d("iframe[data-id='"+n.id+"']").on("load",function(){setTimeout(function(){opt.unblock("#content-main")},50)});e.tabChange(a.tabFilter,n.id);if((typeof(n.panel)=="undefined")&&n.id!=="0"){var m=opt.storage.get("menu");if(m){m=JSON.parse(m);m.push(n);opt.storage.set("menu",JSON.stringify(m))}else{var k=[];k.push(n);opt.storage.set("menu",JSON.stringify(k))}}}else{e.tabChange(a.tabFilter,j)}};var g=new i();c(h,function(j){return g.set(j)})});