<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.j2eefast.framework.sys.mapper.SysAreaMapper">

    <resultMap type="SysAreaEntity" id="SysAreaResult">
       <result property="id"    column="id"    />
       <result property="parentId"    column="parent_id"    />
       <result property="name"    column="name"    />
       <result property="level"    column="level"    />
       <result property="wholeName"    column="whole_name"    />
       <result property="lon"    column="lon"    />
       <result property="lat"    column="lat"    />
       <result property="cityCode"    column="city_code"    />
       <result property="zipCode"    column="zip_code"    />
       <result property="areaCode"    column="area_code"    />
       <result property="pinYin"    column="pin_yin"    />
       <result property="simplePy"    column="simple_py"    />
       <result property="perPinYin"    column="per_pin_yin"    />
     </resultMap>
    
    <!--  实体栏位  --> 
    <sql id="sysAreaColumns">
          a.id AS "id"   ,
          a.parent_id AS "parentId"   ,
          a.name AS "name"   ,
          a.level AS "level"   ,
          a.whole_name AS "wholeName"   ,
          a.lon AS "lon"   ,
          a.lat AS "lat"   ,
          a.city_code AS "cityCode"   ,
          a.zip_code AS "zipCode"   ,
          a.area_code AS "areaCode"   ,
          a.pin_yin AS "pinYin"   ,
          a.simple_py AS "simplePy"   ,
          a.per_pin_yin AS "perPinYin"
      </sql>

     <!-- 外联表  -->
	<sql id="sysAreaJoins">
    </sql>

     <!--  根据获取实体List   -->
     <select id="selectAreaList" resultType="com.j2eefast.framework.sys.entity.SysAreaEntity">
		SELECT
			<include refid="sysAreaColumns"/>
            <if test="_databaseId == 'mysql' || _databaseId  == 'postgresql'">,(CASE  WHEN (SELECT COUNT(1) FROM sys_area WHERE parent_id = a.id) >0 THEN 1 ELSE 0 END) AS "isTreeLeaf"</if>
        FROM sys_area a
		<where>
            <if test="name != null  and name != ''">
                     and a.name LIKE
                     <if test="_databaseId == 'oracle'"> '%'||#{name}||'%'</if>
                     <if test="_databaseId == 'mssql'">'%'+#{name}+'%'</if>
                     <if test="_databaseId == 'mysql' || _databaseId  == 'postgresql'">concat('%',#{name},'%')</if>
			</if>
            <if test="level != null "> AND a.level = #{level} </if>
            <if test="parentId != null "> AND a.parent_id = #{parentId} </if>
            <if test="zipCode != null  and zipCode != ''"> AND a.zip_code = #{zipCode} </if>
            <if test="areaCode != null  and areaCode != ''"> AND a.area_code = #{areaCode} </if>
        </where>
	 </select>
	 
	  <!--  根据获取实体 page   -->
     <select id="findPage" resultType="com.j2eefast.framework.sys.entity.SysAreaEntity">
		SELECT
         <include refid="sysAreaColumns"/>
         <if test="_databaseId == 'mysql' || _databaseId == 'postgresql'">,(CASE  WHEN (SELECT COUNT(1) FROM sys_area WHERE parent_id = a.id) >0 THEN 1 ELSE 0 END) AS "isTreeLeaf"</if>
		FROM sys_area a
		<include refid="sysAreaJoins"/>
        <where>
            <if test="sysArea.name != null  and sysArea.name != ''">
                AND a.name LIKE
                <if test="_databaseId == 'oracle'"> '%'||#{sysArea.name}||'%'</if>
                <if test="_databaseId == 'mssql'">'%'+#{sysArea.name}+'%'</if>
                <if test="_databaseId == 'mysql' || _databaseId  == 'postgresql'">concat('%',#{sysArea.name},'%')</if>
            </if>
            <if test="sysArea.level != null "> AND a.level = #{sysArea.level} </if>
            <if test="sysArea.parentId != null "> AND a.parent_id = #{sysArea.parentId} </if>
            <if test="sysArea.zipCode != null  and sysArea.zipCode != ''"> AND a.zip_code = #{sysArea.zipCode} </if>
            <if test="sysArea.areaCode != null  and sysArea.areaCode != ''"> AND a.area_code = #{sysArea.areaCode} </if>
        </where>
	 </select>
	   
</mapper>