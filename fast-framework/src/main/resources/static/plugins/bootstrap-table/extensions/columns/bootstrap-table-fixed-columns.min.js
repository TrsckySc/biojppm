/**
 * 表格冻结
 * Copyright (c) 2020-Now http://www.j2eefast.com All rights reserved.
 * No deletion without permission
 * @author J2eeFAST
 * @date 2021-03-21
 */
(function(e){var d=null;var g=function(p,w,l,r){var y=[],J=[],I=0,n=w.columns.length,v=p.columns.length;for(var H=0;H<l;H++){var K=r?(H+1):n-H;J[H]=K}if(v==1){for(var H=0;H<p.columns[0].length;H++){if(typeof p.columns[0][H].visible!=="undefined"&&!p.columns[0][H].visible){var A=0;for(var F=0;F<J.length;F++){if(J[F]>=H){A++;break}}if(A>0){I++}}}}var u=new Array();for(var H=0;H<l;H++){var K=r?(H+1):n-H;var z="";for(var G=0;G<v;G++){u[G]=new Array();if(p.columns[G].length!=1){var C=0;for(var F=0;F<p.columns[G].length;F++){if(p.columns[G][F].colspan){C+=p.columns[G][F].colspan}else{if(z.length>0){var t=z.substr(0,z.length-1).split("#");var E=C;for(var B=0;B<t.length;B++){if(G>parseInt(t[B].split("=")[0])&&G<=parseInt(t[B].split("=")[1])){var x=parseInt(t[B].split("=")[0])+parseInt(t[B].split("=")[1])+parseInt(t[B].split("=")[2]);if((E+1)>=parseInt(t[B].split("=")[2])&&!u[G][x]&&(F+1)<p.columns[G].length){E++;u[G][x]=parseInt(t[B].split("=")[2])}if(!y[H]&&E==K&&!p.columns[G][F].colspan){y[H]=w.$header.find("tr:eq("+G+")").find("th:eq("+(F-I)+")").clone(true);if(v>1){y[H].height(w.$header.height())}if(v>1){y[H].attr("rowspan",v)}if(v>1){y[H].css("vertical-align","inherit")}break}}}C=E}C++;if(!y[H]&&(C==K&&p.columns[G][F].rowspan&&(p.columns[G][F].rowspan+G)==v)||(C==K&&(G+1)==v)){y[H]=w.$header.find("tr:eq("+G+")").find("th:eq("+(F-I)+")").clone(true);if(v>1){y[H].height(w.$header.height())}if(v>1){y[H].attr("rowspan",v)}if(v>1){y[H].css("vertical-align","inherit")}}}if(p.columns[G][F].rowspan){z+=G+"="+(G+parseInt(p.columns[G][F].rowspan)-1)+"="+C+"#"}if(z.length>0){var t=z.substr(0,z.length-1).split("#");var E=C;for(var B=0;B<t.length;B++){if(G>parseInt(t[B].split("=")[0])&&G<=parseInt(t[B].split("=")[1])){var x=parseInt(t[B].split("=")[0])+parseInt(t[B].split("=")[1])+parseInt(t[B].split("=")[2]);if((E+1)>=parseInt(t[B].split("=")[2])&&!u[G][x]&&(F+1)<p.columns[G].length){E++;u[G][x]=parseInt(t[B].split("=")[2])}if(!y[H]&&E==K&&!p.columns[G][F].colspan){y[H]=w.$header.find("tr:eq("+G+")").find("th:eq("+(F-I)+")").clone(true);if(v>1){y[H].height(w.$header.height())}if(v>1){y[H].attr("rowspan",v)}if(v>1){y[H].css("vertical-align","inherit")}break}}}C=E}}}}}var D=w.$header.find("tr:eq(0)").clone(true);D.html("");if(r){for(var H=0;H<y.length;H++){D.append(y[H])}}else{for(var H=y.length-1;H>=0;H--){D.append(y[H])}}return D};var a=function(){if(d===null){var l=e("<p/>").addClass("fixed-table-scroll-inner"),m=e("<div/>").addClass("fixed-table-scroll-outer"),k,j;m.append(l);e("body").append(m);k=l[0].offsetWidth;m.css("overflow","scroll");j=l[0].offsetWidth;if(k===j){j=m[0].clientWidth}m.remove();d=k-j}return d};e.extend(e.fn.bootstrapTable.defaults,{fixedColumns:false,fixedNumber:1,rightFixedColumns:false,rightFixedNumber:1});var b=e.fn.bootstrapTable.Constructor,f=b.prototype.initHeader,i=b.prototype.initBody,h=b.prototype.resetView,c=b.prototype.getCaret;b.prototype.initFixedColumns=function(){this.timeoutHeaderColumns_=0;this.timeoutBodyColumns_=0;if(this.options.cardView){if(this.options.fixedColumns){if(e("#"+this.options.id+"-left-fixed-table-columns")){e("#"+this.options.id+"-left-fixed-table-columns").hide()}}if(this.options.rightFixedColumns){if(e("#"+this.options.id+"-right-fixed-table-columns")){e("#"+this.options.id+"-right-fixed-table-columns").hide()}}return}if(this.$el.outerWidth()<=this.$tableContainer.innerWidth()){if(this.options.fixedColumns){if(e("#"+this.options.id+"-left-fixed-table-columns")){e("#"+this.options.id+"-left-fixed-table-columns").hide()}}if(this.options.rightFixedColumns){if(e("#"+this.options.id+"-right-fixed-table-columns")){e("#"+this.options.id+"-right-fixed-table-columns").hide()}}return}var k=this;if(this.options.fixedColumns){var m=this.$tableContainer.find(".left-fixed-table-columns");if(!m.length){this.$fixedBody=e(['<div id="'+this.options.id+'-left-fixed-table-columns" class="left-fixed-table-columns">','<div class="fixed-table-header">',"<table>","<thead></thead>","</table>","</div>",'<div class="fixed-table-body">',"<table>",'<tbody style="background-color: #fff"></tbody>',"</table>","</div>","</div>"].join(""));this.$fixedBody.find("table").attr("class",this.$el.attr("class"));this.$fixedHeaderColumns=this.$fixedBody.find(".fixed-table-header").find("thead");this.$fixedBodyColumns=this.$fixedBody.find(".fixed-table-body").find("tbody");this.$tableBody.before(this.$fixedBody)}else{e("#"+this.options.id+"-left-fixed-table-columns").show()}var j=g(k.options,k,k.options.fixedNumber,true);k.$fixedHeaderColumns.html("").append(j);k.$selectAll=j.find('[name="btSelectAll"]');k.$selectAll.on("click",function(){var n=e(this).prop("checked");k.$fixedBodyColumns.find("input[name=btSelectItem]").filter(":enabled").prop("checked",n);k.$fixedBodyColumns.find("input[name=btSelectItem]").each(function(){if(e(this).attr("disabled")!="disabled"){e(this).closest("tr")[n?"addClass":"removeClass"]("selected")}})})}if(this.options.rightFixedColumns){var l=this.$tableContainer.find(".right-fixed-table-columns");if(!l.length){this.$rightfixedBody=e(['<div id="'+this.options.id+'-right-fixed-table-columns" class="right-fixed-table-columns">','<div class="fixed-table-header">',"<table>","<thead></thead>","</table>","</div>",'<div class="fixed-table-body">',"<table>",'<tbody style="background-color: #fff"></tbody>',"</table>","</div>","</div>"].join(""));this.$rightfixedBody.find("table").attr("class",this.$el.attr("class"));this.$rightfixedHeaderColumns=this.$rightfixedBody.find(".fixed-table-header").find("thead");this.$rightfixedBodyColumns=this.$rightfixedBody.find(".fixed-table-body").find("tbody");this.$tableBody.before(this.$rightfixedBody);if(this.options.fixedColumns){e(".right-fixed-table-columns").attr("style","right:0px;")}}else{e("#"+this.options.id+"-right-fixed-table-columns").show()}k.$rightfixedHeaderColumns.html("").append(g(k.options,k,k.options.rightFixedNumber,false))}};b.prototype.initHeader=function(){f.apply(this,Array.prototype.slice.apply(arguments));if(!this.options.fixedColumns&&!this.options.rightFixedColumns){return}this.initFixedColumns();if(this.options.cardView){return}};b.prototype.initBody=function(){i.apply(this,Array.prototype.slice.apply(arguments));if(!this.options.fixedColumns&&!this.options.rightFixedColumns){return}if(this.options.cardView){return}if(this.options.fixedColumns&&this.$fixedBodyColumns==undefined){return}if(this.options.rightFixedColumns&&this.$rightfixedBody==undefined){return}if(this.$el.outerWidth()<=this.$tableContainer.innerWidth()){if(this.options.fixedColumns){if(e("#"+this.options.id+"-left-fixed-table-columns")){e("#"+this.options.id+"-left-fixed-table-columns").hide()}}if(this.options.rightFixedColumns){if(e("#"+this.options.id+"-right-fixed-table-columns")){e("#"+this.options.id+"-right-fixed-table-columns").hide()}}return}var j=this;if(this.options.fixedColumns){this.$fixedBodyColumns.html("");this.$body.find("> tr[data-index]").each(function(){var l=e(this).find("td");var o=e(this).clone(true),p=o.clone(true).find("td");o.html("");var n=0;for(var m=0;m<j.options.fixedNumber;m++){var k=p.eq(m).clone(true);if(p.eq(m).attr("colspan")){n+=parseInt(p.eq(m).attr("colspan"))}else{n++}if(n==j.options.fixedNumber){o.append(k);break}if(n>j.options.fixedNumber){o.append(k.html("").removeAttr("colspan"));break}else{o.append(k)}}j.$fixedBodyColumns.append(o)})}if(this.options.rightFixedColumns){this.$rightfixedBodyColumns.html("");this.$body.find("> tr[data-index]").each(function(){var s=e(this).innerHeight();var o=e(this).find("td");var p=e(this).clone(true),k=p.clone(true).find("td");p.html("");var r=0,t=0;for(var n=0;n<j.options.rightFixedNumber;n++){var l=o.length-n-1;var q=k.eq(l).attr("colspan");if(typeof q!=="undefined"&&q&&parseInt(q,10)>0){r=r+parseInt(q,10)}t++;if(r>=j.options.rightFixedNumber){break}r++}for(var n=0;n<t;n++){var l=o.length-t+n;var m=k.eq(l).clone(true);p.append(m)}j.$rightfixedBodyColumns.append(p)})}};b.prototype.resetView=function(){h.apply(this,Array.prototype.slice.apply(arguments));if(!this.options.fixedColumns&&!this.options.rightFixedColumns){return}if(this.options.cardView){return}if(this.options.fixedColumns&&this.$fixedBodyColumns==undefined){return}if(this.options.rightFixedColumns&&this.$rightfixedBody==undefined){return}if(this.$el.outerWidth()<=this.$tableContainer.innerWidth()){return}clearTimeout(this.timeoutHeaderColumns_);this.timeoutHeaderColumns_=setTimeout(e.proxy(this.fitHeaderColumns,this),this.$el.is(":hidden")?1000:100);clearTimeout(this.timeoutBodyColumns_);this.timeoutBodyColumns_=setTimeout(e.proxy(this.fitBodyColumns,this),this.$el.is(":hidden")?1000:100)};b.prototype.fitHeaderColumns=function(){var m=this,l=0;if(m.options.fixedColumns){if(this.$body.find("tr:eq(0)").find("td").length==1){this.$fixedBody.hide()}else{this.$body.find("tr:eq(0)").find("td").each(function(p){for(var o=0;o<m.options.fixedNumber;o++){if(p==o){l+=e(this).outerWidth()}}});if(this.options.height){var j=this.$tableBody.height();this.$fixedBody.find(".fixed-table-body").css("height",j+"px")}}}if(m.options.rightFixedColumns){l=0;var n=this.$body.find("tr:eq(0)").find("td").length;if(n==1){this.$rightfixedBody.hide()}else{var k=0;this.$body.find("tr:eq(0)").find("td").each(function(p){for(var o=0;o<m.options.rightFixedNumber;o++){if(p==(n-o-1)){l+=parseInt(e(this).outerWidth(),10);k++}}});this.$rightfixedBody.css("top","0px");if(this.options.height){var j=this.$tableBody.height();this.$rightfixedBody.find(".fixed-table-body").css("height",j+"px")}this.$header.find("tr:eq(0)").find("th").each(function(p){for(var o=0;o<m.options.rightFixedNumber;o++){if(p==(n-o-1)){var r=e(this).outerWidth();var s=e(this).data("field");var q=m.$rightfixedHeaderColumns.find('th[data-field="'+s+'"]');if(p==(n-1)){q.find(".fht-cell").width(r+(o==(m.options.rightFixedNumber-1))?(a()/k):0)}else{q.find(".fht-cell").width(r+(o==(m.options.rightFixedNumber-1))?(a()/k):0)}}}});this.$rightfixedBody.width(l+10).show()}}};b.prototype.fitBodyColumns=function(){var m=this,j=this.$tableBody.height(),l=0;this.$body.find("> tr[data-index]").off("hover").hover(function(){var n=e(this).data("index");if(n!="-99999"){if(m.options.fixedColumns){m.$fixedBody.find('tr[data-index="'+n+'"]').addClass("hover")}if(m.options.rightFixedColumns){m.$rightfixedBody.find('tr[data-index="'+n+'"]').addClass("hover")}}},function(){var n=e(this).data("index");if(n!="-99999"){if(m.options.fixedColumns){m.$fixedBody.find('tr[data-index="'+n+'"]').removeClass("hover")}if(m.options.rightFixedColumns){m.$rightfixedBody.find('tr[data-index="'+n+'"]').removeClass("hover")}}});if(m.options.fixedColumns){if(m._$pywh!=0&&m.options.isFixedColumn){if(m._$pywh>m.$tableContainer.outerWidth()){this.$fixedBody.find(".fixed-table-body").css("overflow-x","scroll")}}var k=m.getVisibleFields();if(!this.$body.find("> tr[data-index]").length){this.$fixedBody.hide();return}this.$body.find("tr:eq(0)").find("td").each(function(o){for(var n=0;n<m.options.fixedNumber;n++){if(o==n){l+=e(this).outerWidth();break}}});this.$fixedBody.css({top:"0px"}).show();this.$body.find(">tr:first-child:not(.no-records-found) > *").each(function(p){var s=e(this),o=p;for(var n=0;n<m.options.fixedNumber;n++){if(p==n){var r=s.outerWidth();var q=m.$fixedHeaderColumns.find('th[data-field="'+k[o]+'"]');q.find(".fht-cell").width(r-1);m.$fixedBodyColumns.find("tr:eq(0)").find("td:eq("+n+")").css({width:r});break}}});this.$header.find("> tr").each(function(n){m.$fixedHeaderColumns.find("tr:eq("+n+")").height(e(this).outerHeight())});this.$body.find("> tr").each(function(n){m.$fixedBodyColumns.find("tr:eq("+n+")").height(e(this).outerHeight())});this.$fixedBody.find("tr[data-index]").off("hover").hover(function(){var n=e(this).data("index");if(n!="-99999"){m.$body.find('tr[data-index="'+n+'"]').addClass("hover");if(m.options.rightFixedColumns){m.$rightfixedBody.find('tr[data-index="'+n+'"]').addClass("hover")}}},function(){var n=e(this).data("index");if(n!="-99999"){m.$body.find('> tr[data-index="'+n+'"]').removeClass("hover");if(m.options.rightFixedColumns){m.$rightfixedBody.find('tr[data-index="'+n+'"]').removeClass("hover")}}})}if(m.options.rightFixedColumns){if(m._$pywh!=0&&m.options.isFixedColumn){if(m._$pywh>m.$tableContainer.outerWidth()){this.$rightfixedBody.find(".fixed-table-body").css("overflow-x","scroll")}}if(!this.$body.find("> tr[data-index]").length){this.$rightfixedBody.hide();return}this.$header.find("> tr").each(function(n){m.$rightfixedHeaderColumns.find("tr:eq("+n+")").height(e(this).outerHeight())});this.$body.find("> tr").each(function(n){m.$rightfixedBodyColumns.find("tr:eq("+n+")").height(e(this).height())});if(this.$rightfixedBody.find(".fixed-table-body").outerHeight(true)<this.$rightfixedBody.find(".fixed-table-body").find("table > tbody").outerHeight(true)){this.$rightfixedBody.find(".fixed-table-header").css({"margin-right":"10px"})}else{this.$rightfixedBody.find(".fixed-table-header").css({"margin-right":""})}this.$rightfixedBody.find("tr[data-index]").off("hover").hover(function(){var n=e(this).data("index");if(n!="-99999"){m.$body.find('tr[data-index="'+n+'"]').addClass("hover");if(m.options.fixedColumns){m.$fixedBody.find('tr[data-index="'+n+'"]').addClass("hover")}}},function(){var n=e(this).data("index");if(n!="-99999"){m.$body.find('> tr[data-index="'+n+'"]').removeClass("hover");if(m.options.fixedColumns){m.$fixedBody.find('tr[data-index="'+n+'"]').removeClass("hover")}}})}if(this.options.clickToSelect){this.$body.find("> tr[data-index] > td").on("click dblclick",function(r){var s=e(this),p=s.parent();var o=p.data("index");console.log("-->>>>index:",o);if(r.type==="click"){if(m.options.fixedColumns){var q=m.$fixedBody.find('tr[data-index="'+o+'"] >td');var n=q.find('[name="'+m.options.selectItemName+'"]');if(n.length){n[0].click()}else{if(m.options.singleSelect){m.$fixedBodyColumns.find("> tr[data-index]").each(function(){if(e(this).data("index")==o){e(this).addClass("selected")}else{e(this).removeClass("selected")}});if(m.options.rightFixedColumns){m.$rightfixedBody.find("tr[data-index]").each(function(){if(e(this).data("index")==o){e(this).addClass("selected")}else{e(this).removeClass("selected")}})}}}}else{if(m.options.rightFixedColumns){var n=p.find('[name="'+m.options.selectItemName+'"]');if(n.length){n[0].click()}if(p.hasClass("selected")){m.$rightfixedBody.find('tr[data-index="'+o+'"]').addClass("selected")}else{m.$rightfixedBody.find('tr[data-index="'+o+'"]').removeClass("selected")}}}}});if(m.options.fixedColumns){this.$fixedBody.find("tr[data-index]").on("click dblclick",function(q){var o=e(this).data("index"),p=e(this);var n=p.find('[name="'+m.options.selectItemName+'"]');if(!n.length){if(m.options.singleSelect){m.$fixedBodyColumns.find("> tr[data-index]").each(function(){if(e(this).data("index")==o){e(this).addClass("selected")}else{e(this).removeClass("selected")}});if(m.options.rightFixedColumns){m.$rightfixedBody.find("tr[data-index]").each(function(){if(e(this).data("index")==o){e(this).addClass("selected")}else{e(this).removeClass("selected")}})}}}})}if(m.options.rightFixedColumns){this.$rightfixedBody.find("tr[data-index]").on("click dblclick",function(q){var o=e(this).data("index");var p=m.$body.find('tr[data-index="'+o+'"]');var n=p.find('[name="'+m.options.selectItemName+'"]');if(n.length){n[0].click()}if(m.options.fixedColumns){var p=m.$fixedBody.find('tr[data-index="'+o+'"] >td');var n=p.find('[name="'+m.options.selectItemName+'"]');if(n.length){n[0].click()}else{if(m.options.singleSelect){m.$rightfixedBody.find("tr[data-index]").each(function(){if(e(this).data("index")==o){e(this).addClass("selected")}else{e(this).removeClass("selected")}});if(m.options.fixedColumns){m.$fixedBodyColumns.find("> tr[data-index]").each(function(){if(e(this).data("index")==o){e(this).addClass("selected")}else{e(this).removeClass("selected")}})}}}}})}}if(this.options.height){this.$tableBody.on("scroll",function(){if(m.options.rightFixedColumns){m.$rightfixedBody.find(".fixed-table-body").scrollTop(e(this).scrollTop())}if(m.options.fixedColumns){m.$fixedBody.find(".fixed-table-body").scrollTop(e(this).scrollTop())}});if(m.options.rightFixedColumns){this.$rightfixedBody.find(".fixed-table-body").off("scroll").on("scroll",function(){m.$tableBody.scrollTop(e(this).scrollTop())})}}};b.prototype.getCaret=function(){var j=this;c.apply(j,Array.prototype.slice.apply(arguments));if(!this.options.fixedColumns&&!this.options.rightFixedColumns){return}if(this.options.cardView){return}if(j.options.fixedColumns&&j.$fixedHeaderColumns){e.each(j.$fixedHeaderColumns.find("th"),function(k,l){var m=typeof e(l).data("sort")!="undefined"?e(l).data("sort"):e(l).data("field");e(l).find(".sortable").removeClass("desc asc").addClass(m===j.options.sortName?j.options.sortOrder:"both")})}if(j.options.rightFixedColumns&&j.$rightfixedHeaderColumns){e.each(j.$rightfixedHeaderColumns.find("th"),function(k,l){var m=typeof e(l).data("sort")!="undefined"?e(l).data("sort"):e(l).data("field");e(l).find(".sortable").removeClass("desc asc").addClass(m===j.options.sortName?j.options.sortOrder:"both")})}}})(jQuery);