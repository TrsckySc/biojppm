/*!
 * Copyright (c) 2020-Now http://www.j2eefast.com All rights reserved.
 * No deletion without permission
 * @author zhouzhou
 * @data 2021-09-20
 * @version 1.0.0
 */
var vm=new Vue({el:"#__app",data:{username:"",password:"",captcha:"",rememberme:false,loadcode:false,phoneValid:false,src:"captcha.gif",tenantId:"",tenantData:[],phoneNo:"",sendValid:true,loginValidCode:"",tenantLabel:TENANTLABEL,login_toggle:MOBILE_TOGGLE,},beforeCreate:function(){if(self!=top){top.location.href=self.location.href}},methods:{refreshCode:function(){this.src=baseURL+"captcha.gif?t="+$.now()},__clearLang:function(){window.localStorage.removeItem("i18nLang")},_onkeydown:function(b){var a=this;if(b&&b.keyCode==13){a.login()}},_phoneValid:function(){if(!vm.phoneValid){vm.phoneValid=true;vm.login_toggle=USERNAME_TOGGLE}else{vm.phoneValid=false;vm.login_toggle=MOBILE_TOGGLE}},setValidCodeTime:function(b){var a=this;--b;if(b==0){$("#butValieCode").val(RM_AUTH_CODE);$("#butValieCode").removeAttr("disabled");return}$("#butValieCode").attr("disabled","disabled");$("#butValieCode").val(b+MM_AUTH_CODE);window.setTimeout(function(){a.setValidCodeTime(b)},1000)},getValidCode:function(){var b=this;if(TENANTMODEL){if(vm.tenantId.length==0){return b.errrInfo(TENANTLABEL)}}var a=vm.phoneNo;if(!(/^1[3456789]\d{9}$/.test(a))){return b.errrInfo(PHONETIP)}if(ISVALIDATIONCODE){$("#verfyImg").find(".mask").css("display","block")}else{var c={"mobile":vm.phoneNo,"tenantId":vm.tenantId};b.sendValidCode(c);return}},sendValidCode:function(b){var a=this;$.ajax({type:"POST",url:baseURL+"getLoginValideCode",data:b,dataType:"json",beforeSend:function(){$(window).block({message:'<div class="loaderbox"><div class="loading-circle"></div> '+WAITING+"</div>"})},success:function(c){$(window).unblock();if(c.code==0){$("#butValieCode").attr("disabled","disabled");$("#loginValidCode").attr("placeholder",SENDOW);vm.sendValid=false;a.setValidCodeTime(60)}else{vm.errrInfo(c.msg)}},error:function(c,d){vm.errrInfo(JSON.parse(c.responseText).msg||c.responseText);$(window).unblock()}})},login:function(d){var c=this;if(this.getCookie("_secretKey")==""){location.reload();return}if(!vm.phoneValid){if(vm.username.length<3||vm.password.length<3){return c.errrInfo(USERNAMEERR)}}if(vm.phoneValid){var b=vm.phoneNo;if(!(/^1[3456789]\d{9}$/.test(b))){return c.errrInfo(PHONETIP)}if(vm.loginValidCode.length!=6){return c.errrInfo(INCORRECT_VERIFICATION_CODE)}var e={"mobile":b,"valideCode":vm.loginValidCode,"tenantId":vm.tenantId,"rememberMe":vm.rememberme};$.ajax({type:"POST",url:baseURL+"valideCodeLogin",data:e,dataType:"json",success:function(f){if(f.code==0){setTimeout(function(){location.href=baseURL+"index"},100)}else{$(window).unblock();vm.errrInfo(f.msg)}},error:function(f,g){vm.errrInfo(JSON.parse(f.responseText).msg||f.responseText);$(window).unblock()}});return}else{if(TENANTMODEL){if(vm.tenantId.length==0){return c.errrInfo(TENANTLABEL)}}if(VERIFICATION){$("#verfyImg").find(".mask").css("display","block")}else{$(window).block({message:'<div class="loaderbox"><div class="loading-circle"></div> '+WAITING+"</div>"});var a=SoftEncryption.loginSM2Encry(vm.username,vm.password,c.getCookie("_secretKey"));var e={"username":a.username,"password":a.password,"kg4":a.kg4,"sign":a.sign,"captcha":vm.captcha,"tenantId":vm.tenantId,"rememberMe":vm.rememberme};c.postLogin(e,true)}return}},selecTenant:function(c,b){var a=b.currentTarget;vm.tenantLabel=a.innerHTML;vm.tenantId=c},errrInfo:function(a){$.toast({heading:WARNING,text:a,hideAfter:6000,position:{right:8,bottom:4},textAlign:"left",showHideTransition:"slide",allowToastClose:true,loader:true,icon:"error"})},getCookie:function(a){if(document.cookie.length>0){c_start=document.cookie.indexOf(a+"=");if(c_start!=-1){c_start=c_start+a.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return __SECRETKEY__},postLogin:function(b,a){$.ajax({type:"POST",url:baseURL+"login",data:b,dataType:"json",success:function(c){if(c.code==0){if($("input[name='rememberUserCode']").is(":checked")){window.localStorage.setItem("rememberUserCode",vm.username)}else{window.localStorage.setItem("rememberUserCode","")}setTimeout(function(){location.href=baseURL+"index"},100)}else{if(c.code=="50004"||c.code=="50006"){if(a){$(window).unblock()}vm.loadcode=true;vm.errrInfo(c.msg);vm.captcha="";vm.password="";vm.refreshCode()}else{if(c.code=="99998"){location.href=baseURL+"authInsu"}else{if(a){$(window).unblock()}vm.errrInfo(c.msg);vm.captcha="";vm.password="";vm.refreshCode()}}}},error:function(c,d){vm.errrInfo(JSON.parse(c.responseText).msg||c.responseText);vm.captcha="";vm.password="";if(a){$(window).unblock()}vm.refreshCode()}})}},mounted:function(){var c=this;if(window.localStorage.getItem("rememberUserCode")&&window.localStorage.getItem("rememberUserCode")!=""){$("input[name='rememberUserCode']").iCheck("check");this.username=window.localStorage.getItem("rememberUserCode")
    }else{$("input[name='rememberUserCode']").iCheck("uncheck")}if(TENANTMODEL){if(window.localStorage.getItem("tenantId")&&window.localStorage.getItem("tenantId")!=""){this.tenantId=window.localStorage.getItem("tenantId");$("#tenantId").val(this.tenantId).select2()}if($.fn.select2!==undefined){$.fn.select2.defaults.set("theme","bootstrap");$("select.form-control:not(.noselect2)").each(function(){$(this).select2({allowClear:false,placeholder:TENANTLABEL})})}}$("input[type=checkbox]").each(function(){$(this).iCheck({checkboxClass:"icheckbox_"+($(this).data("style")||"square-blue")}).on("ifChanged",function(d){if($(this).attr("name")=="rememberme"){if($(this).is(":checked")){vm.rememberme=true}else{vm.rememberme=false}}})});if(typeof(Storage)!=="undefined"){var b=window.localStorage.getItem("mode");if(typeof b!=="undefined"&&b&&b.length>0){$("html").addClass(b)}}$('[data-toggle="tooltip"]').each(function(){$(this).tooltip()});if(VERIFICATION||ISVALIDATIONCODE){$("#verfyImg").slideVerify({baseUrl:ctx,mode:"pop",success:function(f){if(!vm.phoneValid){var d=SoftEncryption.loginSM2Encry(vm.username,vm.password,c.getCookie("_secretKey"));var e={"username":d.username,"password":d.password,"kg4":d.kg4,"sign":d.sign,"captcha":vm.captcha,"tenantId":vm.tenantId,"rememberMe":vm.rememberme};e=$.extend(e,f);c.postLogin(e,false)}else{var e={"mobile":vm.phoneNo,"tenantId":vm.tenantId};e=$.extend(e,f);c.sendValidCode(e)}},error:function(){}})}window.document.onkeydown=c._onkeydown;var a=location.href;if(a.indexOf("kickout=2")>0){c.errrInfo("\u60A8\u88AB\u63D0\u4E0B\u7EBF,\u8BF7\u91CD\u65B0\u767B\u9646!")}if(a.indexOf("kickout=1")>0){c.errrInfo("\u60A8\u7684\u8D26\u53F7\u5728\u53E6\u4E00\u53F0\u8BBE\u5907\u4E0A\u767B\u5F55,\u5982\u975E\u672C\u4EBA\u64CD\u4F5C\uFF0C\u8BF7\u7ACB\u5373\u4FEE\u6539\u5BC6\u7801\uFF01")}}});function selectCallback(c,a,b){if(c=="tenantId"){vm.tenantId=b[0].id;window.localStorage.setItem("tenantId",b[0].id)}};