/*!
 * Copyright (c) 2020-Now http://www.j2eefast.com All rights reserved.
 * No deletion without permission
 * @author ZhouHuan
 * @data 2020-11-27
 */
;layui.define(["element"],function(c){var e=layui.element,d=layui.jquery,f=parent.layer===undefined?layui.layer:parent.layer,h="navtab",b=0,i=function(){this.config={elem:undefined,closed:true}};var a={};i.prototype.set=function(j){var k=this;d.extend(true,k.config,j);return k};i.prototype.init=function(){var m=this;var k=m.config;if(typeof(k.elem)!=="string"&&typeof(k.elem)!=="object"){f.alert("Tab\u9009\u9879\u5361\u9519\u8BEF\u63D0\u793A: elem\u53C2\u6570\u672A\u5B9A\u4E49\u6216\u8BBE\u7F6E\u51FA\u9519\uFF0C\u5177\u4F53\u8BBE\u7F6E\u683C\u5F0F\u8BF7\u53C2\u8003\u6587\u6863API.")}var l;if(typeof(k.elem)==="string"){l=d(""+k.elem+"")}if(typeof(k.elem)==="object"){l=k.elem}if(l.length===0){f.alert("Tab\u9009\u9879\u5361\u9519\u8BEF\u63D0\u793A:\u627E\u4E0D\u5230elem\u53C2\u6570\u914D\u7F6E\u7684\u5BB9\u5668\uFF0C\u8BF7\u68C0\u67E5.")}var j=l.attr("lay-filter");if(j===undefined||j===""){f.alert("Tab\u9009\u9879\u5361\u9519\u8BEF\u63D0\u793A:\u8BF7\u4E3Aelem\u5BB9\u5668\u8BBE\u7F6E\u4E00\u4E2Alay-filter\u8FC7\u6EE4\u5668")}k.elem=l;a.titleBox=l.children("ul.layui-tab-title");a.contentBox=l.children("div.layui-tab-content");a.tabFilter=j;return m};i.prototype.exists=function(n,k,l){var m=a.titleBox===undefined?this.init():this,j=-1;a.titleBox.find("li").each(function(p,q){var o=d(this).children("em");if((d(this).attr("lay-id")==n||o.attr("data-url")==k)&&l==o.attr("data-module")){j=d(this).attr("lay-id")}});return j};i.prototype.tabAdd=function(o){var q=this;var j=q.exists(o.id,o.href,o.module);if(j===-1){opt.block("","#content-main");var l='<iframe width="100%" height="100%" src="'+o.href+'" data-id="'+o.id+'"';if(typeof(o.module)!=="undefined"){l+=' data-module="'+o.module+'"'}l+=' class="larry-iframe"></iframe>';var p="";if(typeof(o.icon)!=="undefined"){p+='<i class="'+o.icon+'"></i>'}if(typeof(o.panel)!=="undefined"){p+='<em data-url="'+o.href+'" panel-id="'+o.panel+'"'}else{p+='<em data-url="'+o.href+'"'}if(typeof(o.module)!=="undefined"){p+=' data-module="'+o.module+'"'}p+='title="'+o.title+'">&nbsp;'+(opt.common.subString(o.title,12,true))+"</em>";if(o.id!=="0"){p+='<i class="fa fa-times-circle-o layui-tab-close" data-id="'+o.id+'"></i>'}e.tabAdd(a.tabFilter,{title:p,content:l,id:o.id});opt.variable._tabIndex=o.id;d("#content-main .layui-tab-item").css("height",d(window).height()-d(".main-footer").outerHeight()-d(".main-header").outerHeight()-40);a.titleBox.find("li").children('i.layui-tab-close[data-id="'+o.id+'"]').on("click",function(){var t=opt.storage.get("menu");if(t){t=JSON.parse(t);for(var v=0;v<t.length;v++){if(t[v].id==d(this).attr("data-id")){t.splice(v,1)}}opt.storage.set("menu",JSON.stringify(t))}var r=false,w;if(a.titleBox.find('li[lay-id="'+d(this).attr("data-id")+'"]').children("em").attr("panel-id")!="undefined"){r=true;w=a.titleBox.find('li[lay-id="'+d(this).attr("data-id")+'"]').children("em").attr("panel-id")}var u=a.titleBox.find('li[lay-id="'+d(this).attr("data-id")+'"]').prev();e.tabDelete(a.tabFilter,d(this).attr("data-id")).init();var y=true,z=true;a.titleBox.find("li").each(function(){if(d(this).hasClass("layui-this")){y=false}if(r){if(d(this).attr("lay-id")==w){z=false}}});if(!z){e.tabChange(a.tabFilter,w);try{var s=d('iframe[data-id="'+w+'"]')[0].contentWindow;if(s.opt.table.options.type==opt.variable.table_type.bootstrapTable){s.$.table.refresh()}else{if(s.opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){s.$.treeTable.refresh()}}}catch(x){}}else{if(y){e.tabChange(a.tabFilter,u.attr("lay-id"))}}});a.titleBox.find('li[lay-id="'+o.id+'"]').on("dblclick",function(){d(this).children('i.layui-tab-close[data-id="'+d(this).attr("lay-id")+'"]').trigger("click")});d("iframe[data-id='"+o.id+"']").on("load",function(){setTimeout(function(){opt.unblock("#content-main")},30)});var n=opt.storage.get("nowPath");e.tabChange(a.tabFilter,o.id);if(o.id=="0"){opt.storage.set("nowPath",n)}if((typeof(o.panel)=="undefined")&&o.id!=="0"){var m=opt.storage.get("menu");if(m){m=JSON.parse(m);m.push(o);opt.storage.set("menu",JSON.stringify(m))}else{var k=[];k.push(o);opt.storage.set("menu",JSON.stringify(k))}}}else{e.tabChange(a.tabFilter,j)}};var g=new i();c(h,function(j){return g.set(j)})});
