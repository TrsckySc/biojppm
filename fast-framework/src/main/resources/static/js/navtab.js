/*!
 * Copyright (c) 2020-Now http://www.j2eefast.com All rights reserved.
 * No deletion without permission
 * navtab 定义Tab
 * @author ZhouHuan
 * @data 2021-09-20
 * @version 2.6.0
 */
layui.define(["element"],function(c){var e=layui.element,d=layui.jquery,f=parent.layer===undefined?layui.layer:parent.layer,h="navtab",b=0,i=function(){this.config={elem:undefined,closed:true}};var a={};i.prototype.set=function(j){var k=this;d.extend(true,k.config,j);return k};i.prototype.init=function(){var m=this;var k=m.config;if(typeof(k.elem)!=="string"&&typeof(k.elem)!=="object"){f.alert("Tab选项卡错误提示: elem参数未定义或设置出错，具体设置格式请参考文档API.")}var l;if(typeof(k.elem)==="string"){l=d(""+k.elem+"")}if(typeof(k.elem)==="object"){l=k.elem}if(l.length===0){f.alert("Tab选项卡错误提示:找不到elem参数配置的容器，请检查.")}var j=l.attr("lay-filter");if(j===undefined||j===""){f.alert("Tab选项卡错误提示:请为elem容器设置一个lay-filter过滤器")}k.elem=l;a.titleBox=l.children("ul.layui-tab-title");a.contentBox=l.children("div.layui-tab-content");a.tabFilter=j;return m};i.prototype.exists=function(n,k,l){var m=a.titleBox===undefined?this.init():this,j=-1;a.titleBox.find("li").each(function(p,q){var o=d(this).children("em");if((d(this).attr("lay-id")==n||o.attr("data-url")==k)&&l==o.attr("data-module")){j=d(this).attr("lay-id")}});return j};i.prototype.tabAdd=function(o){if(opt.common.isEmpty(o)){return}var q=this;var j=q.exists(o.id,o.href,o.module);if(j===-1){opt.block("","#content-main");var l='<iframe width="100%" height="100%" src="'+o.href+'" data-id="'+o.id+'"';if(typeof(o.module)!=="undefined"){l+=' data-module="'+o.module+'"'}l+=' class="larry-iframe"></iframe>';var p="";if(typeof(o.icon)!=="undefined"&&o.icon!=""){p+='<i class="'+o.icon+'"></i>'}if(typeof(o.panel)!=="undefined"){p+='<em data-url="'+o.href+'" panel-id="'+o.panel+'"'}else{p+='<em data-url="'+o.href+'"'}if(typeof(o.module)!=="undefined"){p+=' data-module="'+o.module+'"'}p+='title="'+o.title+'">&nbsp;'+(opt.common.subString(o.title,12,true))+"</em>";if(o.id!=="0"){p+='<i class="fa fa-times-circle-o layui-tab-close" data-id="'+o.id+'"></i>'}e.tabAdd(a.tabFilter,{title:p,content:l,id:o.id});opt.variable._tabIndex=o.id;d("#content-main .layui-tab-item").css("height",d(window).height()-d(".main-footer").outerHeight()-d(".main-header").outerHeight()-40);a.titleBox.find("li").children('i.layui-tab-close[data-id="'+o.id+'"]').on("click",function(){var u=opt.storage.get("menu");if(u){u=JSON.parse(u);for(var w=0;w<u.length;w++){if(u[w].id==d(this).attr("data-id")){u.splice(w,1)}}opt.storage.set("menu",JSON.stringify(u))}var B=d(this).attr("data-id");var r=false,x;var t=a.titleBox.find('li[lay-id="'+B+'"]').children("em").attr("panel-id");if(typeof t!="undefined"&&t){r=true;x=t}var v=a.titleBox.find('li[lay-id="'+B+'"]').next();if(v.length==0||v.attr("lay-stope")=="tabmore"){v=a.titleBox.find('li[lay-id="'+B+'"]').prev()}d("#content-main").find(".layui-tab-item").each(function(){var C=d(this);if(C.children('iframe[data-id="'+B+'"]').data("id")==B){C.remove();a.titleBox.find('li[lay-id="'+B+'"]').remove()}});var z=true,A=true;a.titleBox.find("li").each(function(){if(d(this).hasClass("layui-this")){z=false}if(r){if(d(this).attr("lay-id")==x){A=false}}});if(!A){a.titleBox.find('li[lay-id="'+x+'"]').trigger("click");try{var s=d('iframe[data-id="'+x+'"]')[0].contentWindow;if(s.opt.table.options.type==opt.variable.table_type.bootstrapTable){s.$.table.refresh()}else{if(s.opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){s.$.treeTable.refresh()}}}catch(y){}}else{if(z){if(v.length==0){a.titleBox.find('li[lay-id="0"]').trigger("click")}else{a.titleBox.find('li[lay-id="'+v.attr("lay-id")+'"]').trigger("click")}}}});a.titleBox.find('li[lay-id="'+o.id+'"]').on("dblclick",function(){d(this).children('i.layui-tab-close[data-id="'+d(this).attr("lay-id")+'"]').trigger("click")});a.titleBox.find('li[lay-id="'+o.id+'"]').off("click").on("click",function(s){var r=d(this).attr("lay-id");a.titleBox.find("li").each(function(){if(d(this).attr("lay-id")==r){d(this).addClass("layui-this")}else{d(this).removeClass("layui-this")}});d("#content-main").find(".layui-tab-item").each(function(){var t=d(this);if(t.children('iframe[data-id="'+r+'"]').data("id")==r){t.addClass("layui-show")}else{t.removeClass("layui-show")}});layui.event.call(this,"element","tab(main-tab)");s.stopPropagation()});d("iframe[data-id='"+o.id+"']").on("load",function(){setTimeout(function(){opt.unblock("#content-main")},30)});var n=opt.storage.get("nowPath");e.tabChange(a.tabFilter,o.id);if(o.id=="0"){opt.storage.set("nowPath",n)}if((typeof(o.panel)=="undefined")&&o.id!=="0"){var m=opt.storage.get("menu");if(m){m=JSON.parse(m);m.push(o);opt.storage.set("menu",JSON.stringify(m))}else{var k=[];k.push(o);opt.storage.set("menu",JSON.stringify(k))}}}else{a.titleBox.find('li[lay-id="'+j+'"]').trigger("click")}};i.prototype.tabChange=function(j){a.titleBox.find('li[lay-id="'+j+'"]').trigger("click")};i.prototype.tabDelete=function(j){d("#content-main").find(".layui-tab-item").each(function(){var k=d(this);
	if(k.children('iframe[data-id="'+j+'"]').data("id")==j){k.remove();a.titleBox.find('li[lay-id="'+j+'"]').remove()}})};var g=new i();c(h,function(j){return g.set(j)})});