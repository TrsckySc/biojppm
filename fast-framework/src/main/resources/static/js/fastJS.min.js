/*!
 * Copyright (c) 2020-Now http://www.j2eefast.com All rights reserved.
 * fastJS 封装常用方法
 * @author ZhouHuan 二次封装 新增若干方法优化部分BUG
 * @date 2020-02-20
 *       2020-05-17 修复导出报表问题
 * @version v1.0.10
 */
if(typeof jQuery==="undefined"){throw new Error("fastJS JavaScript requires jQuery")}(function($,window,undefined){var opt={variable:{navtab:null,_tabIndex:-999,tindex:0,pushMenu:null,version:"1.0.1",debug:true,table_type:{bootstrapTable:0,bootstrapTreeTable:1},modal_status:{SUCCESS:"success",FAIL:"error",WARNING:"warning"},web_status:{SUCCESS:"00000",FAIL:500,WARNING:"50001"},skins:["skin-blue","skin-black","skin-red","skin-yellow","skin-purple","skin-green","skin-blue-light","skin-black-light","skin-red-light","skin-yellow-light","skin-purple-light","skin-green-light"]},sidebarCollapse:function(){opt.variable.pushMenu.expandOnHover();if(!$("body").hasClass("sidebar-collapse")){$('[data-layout="sidebar-collapse"]').click()}$('[data-toggle="push-menu"]').click()},pushMenuInit:function(){$(".main-sidebar").unbind("mouseenter").unbind("mouseleave")},wclearInterval:function(){window.clearInterval(opt.variable.tindex)},getMessage:function(){$.getJSON("sys/user/info?_"+$.now(),function(r){})},outLogin:function(msg,comm){opt.layer.open({type:1,title:false,closeBtn:false,area:"300px;",shade:0.8,id:"LAY_layuipro",btn:[$.i18n.prop("确定")],btnAlign:"c",moveType:1,content:'<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: red; font-weight: bold;"><span style="color:Yellow">'+msg+"</span></br>"+comm+"</div>",btn1:function(index){opt.layer.close(index);window.location.href="logout"}})},debug:function(message){if(window.console&&opt.variable.debug){console.log(message)}},toast:function(){if($.toast){return $.toast}try{if(parent.$.toast){return parent.$.toast}if(parent.parent.$.toast){return parent.parent.$.toast}if(top.$.toast){return top.$.toast}}catch(e){}return null}(),error:function(msg,callback){opt.modal.enable();if(opt.toast){opt.toast({heading:$.i18n.prop("警告"),text:msg,hideAfter:4000,position:{right:7,bottom:36},showHideTransition:"slide",afterHidden:function(){if(typeof(callback)==="function"){callback("ok")}},icon:"error"})}else{opt.modal.alertError(msg)}},success:function(msg,callback){if(opt.toast){opt.toast({heading:$.i18n.prop("成功"),text:msg,hideAfter:4000,position:{right:7,bottom:36},showHideTransition:"slide",afterHidden:function(){if(typeof(callback)==="function"){callback("ok")}},icon:"success"})}else{layui.use("layer",function(){var layer=layui.layer;layer.msg(msg)});if(typeof(callback)==="function"){callback("ok")}}},warning:function(text,callback){if(opt.toast){opt.toast({heading:$.i18n.prop("警告"),text:text,hideAfter:4000,position:{right:7,bottom:36},showHideTransition:"slide",afterHidden:function(){if(typeof(callback)==="function"){callback("ok")}},icon:"warning"})}else{opt.modal.alertWarning(text)}},changeSkin:function(cls){$.each(opt.variable.skins,function(i){$("body").removeClass(opt.variable.skins[i])});$("body").addClass(cls);opt.storage.set("skin",cls);return false},createMenuItem:function(dataUrl,menuName){if(top.location!==self.location){var dataIndex=opt.common.randomString(16);var panelId,module;if(dataUrl==undefined||$.trim(dataUrl).length==0){return false}if(opt.common.isEmpty(parent.opt.variable.navtab)){parent.opt.createMenuItem(dataUrl,menuName);return}var topWindow=$(window.parent.document);if($(".layui-tab-title li",topWindow).length>0){$(".layui-tab-title li",topWindow).each(function(){if($(this).hasClass("layui-this")){panelId=$(this).attr("lay-id");module=$(this).children("em").data("module")}})}var data={href:dataUrl,icon:"fa fa-plus-square",panel:panelId,title:menuName,module:module,id:dataIndex};parent.opt.navTabAdd(data);return}else{opt.selfLayer.open({type:2,maxmin:true,shadeClose:true,title:menuName,area:[($(window).width()-100)+"px",($(window).height()-100)+"px"],content:dataUrl})}},closeItem:function(dataId){if(top.location!=self.location){var topWindow=$(window.parent.document);if($(".layui-tab-title li",topWindow).length>0){if(opt.common.isNotEmpty(dataId)){$('.layui-tab-title li[lay-id="'+dataId+'"]',topWindow).children('i.layui-tab-close[data-id="'+data.id+'"]').trigger("click")}else{$(".layui-tab-title li",topWindow).each(function(){if($(this).hasClass("layui-this")){$(this).children('i.layui-tab-close[data-id="'+$(this).attr("lay-id")+'"]').trigger("click")}})}}else{try{if(parent.opt.table.options.type==opt.variable.table_type.bootstrapTable){parent.$.table.refresh()}else{if(parent.opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){parent.$.treeTable.refresh()}}}catch(e){}parent.opt.selfLayer.closeAll()}}else{window.opener=null;window.open("","_self");window.close()}},block:function(value,element){if(opt.common.isNotEmpty(element)){$(element).block({message:'<div class="loaderbox"><div class="loading-activity"></div> '+$.i18n.prop(value)+"</div>"})}else{$.blockUI({message:'<div class="loaderbox"><div class="loading-activity"></div> '+$.i18n.prop(value)+"</div>"})
}},unblock:function(element){if(opt.common.isNotEmpty(element)){$(element).unblock()}else{$.unblockUI()}},template:function(id,data,callback){var tpl=String($("#"+id).html()).replace(/(\/\/\<!\-\-)|(\/\/\-\->)/g,""),data=data||[];if(typeof callback=="function"){laytpl(tpl).render(data||[],function(render){callback(render)});return null}return laytpl(tpl).render(data||[])},getCookie:function(name){if(document.cookie.length>0){var c_start=document.cookie.indexOf(name+"=");if(c_start!=-1){c_start=c_start+name.length+1;var c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""},layer:function(){try{if(top.layer){return top.layer}if(parent.parent.layer){return parent.parent.layer}if(parent.layer){return parent.layer}}catch(e){}if(window.layer){return layer}return null}(),selfLayer:function(){if(window.layer){return layer}try{if(top.layer&&top.layer.window){return top.layer}if(parent.parent.layer&&parent.parent.layer.window){return parent.parent.layer}if(parent.layer&&parent.layer.window){return parent.layer}}catch(e){}return null}(),navDelTab:function(dataId){layui.element.tabDelete("main-tab",dataId).init()},navTabAdd:function(data){opt.variable.navtab.tabAdd(data)},navToTab:function(dataId){layui.element.tabChange("main-tab",dataId)},navDelTabNow:function(){if($(".layui-tab-title li").length>1){$(".layui-tab-title li").each(function(){if($(this).attr("lay-id")!=0){opt.navDelTab($(this).attr("lay-id"))}})}},calSumWidth:function(elements){var width=0;$(elements).each(function(){width+=$(this).outerWidth(true)});return width},scrollToTab:function(element){var $tabTitle=$("#larry-tab .layui-tab-title"),marginLeft=Math.abs(parseInt($tabTitle.css("margin-left"))),marginLeftVal=opt.calSumWidth($(element).prevAll()),marginRightVal=Math.abs(parseInt(opt.calSumWidth($(element).nextAll())));var tab_bar=Math.abs(parseInt($tabTitle.children(".layui-tab-bar").outerWidth(true)));marginRightVal=marginRightVal-tab_bar;var visibleWidth=$tabTitle.outerWidth(true)-70;var tabwidth=0;var scrollVal=0;var DISPLACEMENT=210;$tabTitle.children("li").each(function(){tabwidth+=$(this).outerWidth(true)});if(tabwidth<visibleWidth){$tabTitle.css("margin-left","0px");return false}if(marginRightVal==0){scrollVal=tabwidth-visibleWidth}if(marginLeftVal>visibleWidth){scrollVal=parseInt((marginLeftVal/DISPLACEMENT))*DISPLACEMENT;if((scrollVal+visibleWidth)>tabwidth){scrollVal=tabwidth-visibleWidth}}$tabTitle.css("margin-left",0-scrollVal+"px");return},scrollTabLeft:function(){var $tabTitle=$("#larry-tab .layui-tab-title");var marginLeftVal=Math.abs(parseInt($tabTitle.css("margin-left")));var visibleWidth=$tabTitle.outerWidth(true)-70;var tabwidth=0;$tabTitle.children("li").each(function(){tabwidth+=$(this).outerWidth(true)});var scrollVal=0;var DISPLACEMENT=210;if(tabwidth<visibleWidth||marginLeftVal==0){$tabTitle.css("margin-left","0px");return false}else{if(marginLeftVal>DISPLACEMENT){scrollVal=marginLeftVal-DISPLACEMENT}else{scrollVal=0}}$tabTitle.css("margin-left",0-scrollVal+"px")},scrollTabRight:function(){var $tabTitle=$("#larry-tab .layui-tab-title");var marginLeftVal=Math.abs(parseInt($tabTitle.css("margin-left")));var visibleWidth=$tabTitle.outerWidth(true)-70;var tabwidth=0;$tabTitle.children("li").each(function(){tabwidth+=$(this).outerWidth(true)});var scrollVal=0;var DISPLACEMENT=210;if(tabwidth<visibleWidth){$tabTitle.css("margin-left","0px");return false}else{if((tabwidth-marginLeftVal-DISPLACEMENT)>visibleWidth){scrollVal=marginLeftVal+DISPLACEMENT}else{scrollVal=tabwidth-visibleWidth}$tabTitle.css("margin-left",0-scrollVal+"px")}},storage:{set:function(key,value){window.localStorage.setItem(_username+key,value)},get:function(key){return window.localStorage.getItem(_username+key)},remove:function(key){window.localStorage.removeItem(_username+key)},clear:function(){window.localStorage.clear()}},table:{config:{},options:{},set:function(id){if(opt.common.getLength(opt.table.config)>1){var tableId=opt.common.isEmpty(id)?$(event.currentTarget).parents(".bootstrap-table").find(".table").attr("id"):id;if(opt.common.isNotEmpty(tableId)){opt.table.options=opt.table.get(tableId)}}},get:function(id){return opt.table.config[id]},rememberSelecteds:{},rememberSelectedIds:{},},common:{isEmpty:function(value){if(value===null||this.trim(value)===""||typeof(value)=="undefined"){return true}return false},isPrimitive:function(value){return(typeof value==="string"||typeof value==="number"||typeof value==="symbol"||typeof value==="boolean")},isNotEmpty:function(value){return !opt.common.isEmpty(value)},nullToStr:function(value,_default){if(opt.common.isEmpty(value)){return(opt.common.isEmpty(_default))?"":_default}return value},visible:function(value){if(opt.common.isEmpty(value)||value==true){return true}return false},trim:function(value){if(value==null){return""}return value.toString().replace(/(^\s*)|(\s*$)|\r|\n/g,"")},hideStr:function(value,len){if(opt.common.isEmpty(value)){return"-"
}else{return"..."+value.substr(value.length-len,len)}},equals:function(str,that){return str==that},equalsIgnoreCase:function(str,that){return String(str).toUpperCase()===String(that).toUpperCase()},split:function(str,sep,maxLen){if(opt.common.isEmpty(str)){return null}var value=String(str).split(sep);return maxLen?value.slice(0,maxLen-1):value},sprintf:function(str){var args=arguments,flag=true,i=1;str=str.replace(/%s/g,function(){var arg=args[i++];if(typeof arg==="undefined"){flag=false;return""}return arg});return flag?str:""},random:function(min,max){return Math.floor((Math.random()*max)+min)},randomString:function(len){len=len||32;var $chars="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";var maxPos=$chars.length;var pwd="";for(i=0;i<len;i++){pwd+=$chars.charAt(Math.floor(Math.random()*maxPos))}return pwd},startWith:function(value,start){var reg=new RegExp("^"+start);return reg.test(value)},endWith:function(value,end){var reg=new RegExp(end+"$");return reg.test(value)},uniqueFn:function(array){var result=[];var hashObj={};for(var i=0;i<array.length;i++){if(!hashObj[array[i]]){hashObj[array[i]]=true;result.push(array[i])}}return result},join:function(array,separator){if(opt.common.isEmpty(array)){return null}return array.join(separator)},formToJSON:function(formId){var json={};$.each($("#"+formId).serializeArray(),function(i,field){if(json[field.name]){json[field.name]+=(","+field.value)}else{json[field.name]=field.value}});return json},getJsonValue:function(obj,k){var _r;for(var key in obj){if(key==k){_r=obj[key];break}}return _r},objToEmpty:function(obj){for(var key in obj){if(Array.prototype==obj[key].__proto__){obj[key]=[]}else{if(typeof obj[key]=="string"){obj[key]=""}else{if(typeof obj[key]=="number"){obj[key]=0}}}}return obj},getLength:function(obj){var count=0;for(var i in obj){if(obj.hasOwnProperty(i)){count++}}return count},copy:function(text){var oInput=document.createElement("input");oInput.value=text;$(oInput).css({opacity:"0"});$(oInput).attr({name:"__copy_secukey"});document.body.appendChild(oInput);oInput.select();document.execCommand("Copy");oInput.className="oInput";$("input[name='__copy_secukey']").remove()},getCheckboxValue:function(name){var txt="";$('input[name="'+name+'"]').each(function(){if($(this).is(":checked")){txt+=$(this).val()+","}});if(txt.length>0){txt=txt.substring(0,txt.length-1)}return txt},toNumber:function(val){var n=parseFloat(val);return isNaN(n)?val:n},remove:function(arr,item){if(arr.length){var index=arr.indexOf(item);if(index>-1){return arr.splice(index,1)}}},toArray:function(list,start){start=start||0;var i=list.length-start;var ret=new Array(i);while(i--){ret[i]=list[i+start]}return ret},extend:function(to,_from){for(var key in _from){to[key]=_from[key]}return to},toObject:function(arr){var that=this;var res={};for(var i=0;i<arr.length;i++){if(arr[i]){that.extend(res,arr[i])}}return res},formatMoney:function(number,places,symbol,thousand,decimal){number=number||0;places=!isNaN(places=Math.abs(places))?places:2;symbol=symbol!==undefined?symbol:"$";thousand=thousand||",";decimal=decimal||".";var negative=number<0?"-":"",i=parseInt(number=Math.abs(+number||0).toFixed(places),10)+"",j=(j=i.length)>3?j%3:0;return symbol+negative+(j?i.substr(0,j)+thousand:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+thousand)+(places?decimal+Math.abs(number-i).toFixed(places).slice(2):"")},playSound:function(src){if(!(src.indexOf("http")==0)){src=baseURL+"static/audio/"+src+".wav"}if(!!window.ActiveXObject||"ActiveXObject" in window){var embed=document.noticePlay;if(embed){embed.remove()}embed=document.createElement("embed");embed.setAttribute("name","noticePlay");embed.setAttribute("src",src);embed.setAttribute("autostart",true);embed.setAttribute("loop",false);embed.setAttribute("hidden",true);document.body.appendChild(embed);embed=document.noticePlay;embed.volume=100}else{var audio=document.createElement("audio");audio.setAttribute("hidden",true);audio.setAttribute("src",src);document.body.appendChild(audio);audio.addEventListener("ended",function(){audio.parentNode.removeChild(audio)},false);audio.play()}},digit:function(e,t){var i="";e=String(e),t=t||2;for(var n=e.length;n<t;n++){i+="0"}return e<Math.pow(10,t)?i+(0|e):e},toDateString:function(data,t){var that=this,n=new Date(data||new Date),a=[that.digit(n.getFullYear(),4),that.digit(n.getMonth()+1),that.digit(n.getDate())],o=[that.digit(n.getHours()),that.digit(n.getMinutes()),that.digit(n.getSeconds())];return t=t||"yyyy-MM-dd HH:mm:ss",t.replace(/yyyy/g,a[0]).replace(/MM/g,a[1]).replace(/dd/g,a[2]).replace(/HH/g,o[0]).replace(/mm/g,o[1]).replace(/ss/g,o[2])},escape:function(e){return String(e||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},},modal:{icon:function(type){var icon="";if(type==opt.variable.modal_status.WARNING){icon=0}else{if(type==opt.variable.modal_status.SUCCESS){icon=1}else{if(type==opt.variable.modal_status.FAIL){icon=2
}else{icon=3}}}return icon},msg:function(content,type){if(type!=undefined){layui.use("layer",function(){var layer=layui.layer;layer.msg(content,{icon:opt.modal.icon(type),time:1000,shift:5})})}else{layui.use("layer",function(){var layer=layui.layer;layer.msg(content)})}},msgError:function(content){opt.modal.msg(content,opt.variable.modal_status.FAIL)},msgSuccess:function(content){opt.modal.msg(content,opt.variable.modal_status.SUCCESS)},msgWarning:function(content){opt.modal.msg(content,opt.variable.modal_status.WARNING)},alert:function(content,type,shadeClose){opt.selfLayer.alert(content,{icon:opt.modal.icon(type),title:$.i18n.prop("系统提示"),shadeClose:opt.common.isEmpty(shadeClose)?true:shadeClose,btn:['<i class="fa fa-check"></i> '+$.i18n.prop("确定")],btnclass:["btn btn-primary"],})},msgReload:function(msg,type){opt.selfLayer.msg(msg,{icon:opt.modal.icon(type),time:500,shade:[0.1,"#8F8F8F"]},function(){opt.modal.reload()})},alertError:function(content){opt.modal.alert(content,opt.variable.modal_status.FAIL)},alertSuccess:function(content){opt.modal.alert(content,opt.variable.modal_status.SUCCESS)},alertInfo:function(content){opt.modal.alert(content,"3")},success:function(msg,callback){opt.selfLayer.alert(msg,{icon:1,closeBtn:0,title:$.i18n.prop("系统提示"),anim:1,skin:"layui-layer-molv",yes:function(index){if(typeof(callback)==="function"){callback("ok")}opt.selfLayer.close(index)}})},error:function(msg,callback){opt.error(msg,callback)},warning:function(msg,callback){opt.warning(msg,callback)},alertWarning:function(content){opt.modal.alert(content,opt.variable.modal_status.WARNING,true)},close:function(){var index=opt.selfLayer.getFrameIndex(window.name);if(opt.common.isNotEmpty(index)){opt.selfLayer.close(index)}else{opt.layer.closeAll()}},closeAll:function(){opt.selfLayer.closeAll();opt.layer.closeAll()},confirm:function(content,callback,shadeClose){opt.selfLayer.confirm(content,{icon:3,shadeClose:opt.common.isEmpty(shadeClose)?true:shadeClose,title:'<i class="fa fa-exclamation-circle"></i> '+$.i18n.prop("系统提示"),btn:['<i class="fa fa-check"></i> '+$.i18n.prop("确定"),'<i class="fa fa-close"></i> '+$.i18n.prop("取消")]},function(index){if(typeof(callback)==="function"){callback("ok")}opt.selfLayer.close(index)})},open:function(title,url,width,height,callback,yes){if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){width="auto";height="auto"}if(opt.common.isEmpty(title)){title=false}if(opt.common.isEmpty(url)){url="/404.html"}if(opt.common.isEmpty(width)){width=800}if(opt.common.isEmpty(height)){height=($(window).height()-50)}var full=false;if(width!=="auto"||height!=="auto"){if(width>$(window).width()||height>$(window).height()){full=true}}var submit;if(!opt.common.isEmpty(yes)&&yes&&!opt.common.isEmpty(callback)){submit=function(index,layero){var iframeWin=layero.find("iframe")[0];if(typeof iframeWin.contentWindow.submitHandler=="function"){if(iframeWin.contentWindow.submitHandler(index,layero)){callback(index,layero,opt.selfLayer)}}}}else{if(opt.common.isEmpty(callback)){submit=function(index,layero){var iframeWin=layero.find("iframe")[0];if(typeof iframeWin.contentWindow.submitHandler=="function"){iframeWin.contentWindow.submitHandler(index,layero)}else{opt.selfLayer.close(index)}}}else{submit=function(index,layero){callback(index,layero)}}}opt.modal.loading($.i18n.prop("数据加载中，请稍后..."));var index=opt.selfLayer.open({type:2,area:[width+"px",height+"px"],fix:false,maxmin:true,shade:0.3,title:$.i18n.prop(title),content:url,btn:['<i class="fa fa-check"></i> '+$.i18n.prop("确定"),'<i class="fa fa-close"></i> '+$.i18n.prop("取消")],shadeClose:true,yes:submit,success:function(layero,index){var iframeWin=layero.find("iframe")[0];if(!opt.common.isEmpty(iframeWin.contentWindow.onLoadSuccess)){iframeWin.contentWindow.onLoadSuccess(index,layero,opt.selfLayer)}opt.modal.closeLoading()},cancel:function(index){return true}});if(full){opt.selfLayer.full(index)}},openOptions:function(options){var _url=opt.common.isEmpty(options.url)?"/404.html":options.url;var _title=opt.common.isEmpty(options.title)?$.i18n.prop("系统窗口"):$.i18n.prop(options.title);var _width=opt.common.isEmpty(options.width)?"800":options.width;var _height=opt.common.isEmpty(options.height)?($(window).height()-50):options.height;var _btn=['<i class="fa fa-check"></i> '+$.i18n.prop("确定"),'<i class="fa fa-close"></i> '+$.i18n.prop("取消")];if(opt.common.isEmpty(options.yes)){options.yes=function(index,layero){options.callBack(index,layero,opt.selfLayer)}}opt.selfLayer.open({type:2,maxmin:true,shade:0.3,title:_title,fix:false,area:[_width+"px",_height+"px"],content:_url,shadeClose:opt.common.isEmpty(options.shadeClose)?true:options.shadeClose,skin:options.skin,btn:opt.common.isEmpty(options.btn)?_btn:options.btn,yes:options.yes,success:function(layero,index){if(!opt.common.isEmpty(options.obj)){var iframeWin=layero.find("iframe")[0];if(typeof(iframeWin.contentWindow.onLoadSuccess)==="function"){iframeWin.contentWindow.onLoadSuccess(options.obj,layero,index,opt.selfLayer)
}else{opt.modal.error("页面传参错误!")}}},cancel:function(){return true}})},openMainWin:function(options){var _url=opt.common.isEmpty(options.url)?"/404.html":options.url;var _title=opt.common.isEmpty(options.title)?$.i18n.prop("系统窗口"):$.i18n.prop(options.title);var _width=opt.common.isEmpty(options.width)?$(top.window).width()-100:options.width;var _height=opt.common.isEmpty(options.height)?$(top.window).height()-100:options.height;if(opt.common.isEmpty(options.but)){options.but=true}if(options.but){var _btn=['<i class="fa fa-check"></i> '+$.i18n.prop("确定"),'<i class="fa fa-close"></i> '+$.i18n.prop("取消")];if(!opt.common.isEmpty(options.callBack)){options.yes=function(index,layero){options.callBack(index,layero,opt.layer)}}else{options.yes=function(index,layero){opt.layer.close(index)}}opt.layer.open({type:2,maxmin:true,shadeClose:true,title:_title,area:[_width+"px",_height+"px"],content:_url,success:function(layero,index){var iframeWin=layero.find("iframe")[0];if(typeof(iframeWin.contentWindow.onLoadSuccess)==="function"){iframeWin.contentWindow.onLoadSuccess(index,layero,opt.layer)}},btn:opt.common.isEmpty(options.btn)?_btn:options.btn,yes:options.yes,cancel:function(){return true}})}else{opt.layer.open({type:2,maxmin:true,shadeClose:true,title:_title,area:[_width+"px",_height+"px"],content:_url,success:function(layero,index){opt.selfLayer=opt.layer;var iframeWin=layero.find("iframe")[0];if(typeof(iframeWin.contentWindow.onLoadSuccess)==="function"){iframeWin.contentWindow.onLoadSuccess(index,layero,opt.layer)}}})}},openFull:function(title,url,width,height){if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){width="auto";height="auto"}if(opt.common.isEmpty(title)){title=false}if(opt.common.isEmpty(url)){url="/404.html"}if(opt.common.isEmpty(width)){width=800}if(opt.common.isEmpty(height)){height=($(window).height()-50)}var index=opt.selfLayer.open({type:2,area:[width+"px",height+"px"],fix:false,maxmin:true,shade:0.3,title:title,content:url,btn:['<i class="fa fa-check"></i> '+$.i18n.prop("确定"),'<i class="fa fa-close"></i> '+$.i18n.prop("取消")],shadeClose:true,yes:function(index,layero){var iframeWin=layero.find("iframe")[0];iframeWin.contentWindow.submitHandler(index,layero)},cancel:function(index){return true}});opt.selfLayer.full(index)},openTab:function(title,url){opt.createMenuItem(url,title)},parentTab:function(title,url){var dataId=window.frameElement.getAttribute("data-id");opt.createMenuItem(url,title);opt.closeItem(dataId)},closeTab:function(dataId){opt.closeItem(dataId)},disable:function(){var doc=window.top==window.parent?window.document:window.parent.document;try{$("a[class*=layui-layer-btn]",doc).addClass("layer-disabled");$('button[class="btn btn-sm btn-primary"]',doc).attr("disabled",true)}catch(e){}},enable:function(){var doc=window.top==window.parent?window.document:window.parent.document;try{$("a[class*=layui-layer-btn]",doc).removeClass("layer-disabled");$('button[class="btn btn-sm btn-primary"]',doc).attr("disabled",false)}catch(e){}},loading:function(message){$.blockUI({message:'<div class="loaderbox"><div class="loading-activity"></div> '+message+"</div>"})},closeLoading:function(){setTimeout(function(){$.unblockUI()},50)},closeNowLoading:function(){if(top.location!=self.location){$(".content-wrapper",window.parent.document).unblock()}else{$.unblockUI()}},reload:function(){parent.location.reload()}},operate:{submit:function(url,type,dataType,data,callback,del){var config={url:url,type:type,dataType:dataType,data:data,beforeSend:function(){opt.modal.loading("正在处理中，请稍后...")},success:function(result){if(result.code==opt.variable.web_status.SUCCESS&&opt.table.options.type==opt.variable.table_type.bootstrapTable){if(!opt.common.isEmpty(del)&&del){if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){var s=opt.common.getJsonValue(data,"ids").split(",");var column=opt.common.isEmpty(opt.table.options.uniqueId)?opt.table.options.columns[1].field:opt.table.options.uniqueId;var selectedRows=opt.table.rememberSelecteds[opt.table.options.id];var p=[];if(opt.common.isNotEmpty(selectedRows)){for(var j=0;j<selectedRows.length;j++){for(var i=0;i<s.length;i++){if(opt.common.getJsonValue(selectedRows[j],column)===s[i]){p[p.length]=selectedRows[j];selectedRows.splice(j,1);j=j-1}}}}var selectedIds=opt.table.rememberSelectedIds[opt.table.options.id];if(opt.common.isNotEmpty(selectedIds)){for(var j=0;j<selectedIds.length;j++){for(var i=0;i<p.length;i++){if(opt.common.getJsonValue(p[i],column)===selectedIds[j]){selectedIds.splice(j,1);j=j-1}}}}}}}if(typeof callback=="function"){callback(result)}opt.operate.ajaxSuccess(result)}};$.ajax(config)},delPost:function(url,data,callback){if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){opt.table.rememberSelecteds={};opt.table.rememberSelectedIds={}}opt.operate.submit(url,"post","json",data,callback)},post:function(url,data,callback){opt.operate.submit(url,"post","json",data,callback)
},get:function(url,callback){opt.operate.submit(url,"get","json","",callback)},detail:function(id,title,width,height){opt.table.set();var _url=opt.operate.detailUrl(id);var _width=opt.common.isEmpty(width)?"800":width;var _height=opt.common.isEmpty(height)?($(window).height()-50):height;if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){_width="auto";_height="auto"}var options={title:opt.common.isEmpty(title)?opt.table.options.modalName+"详细":title,width:_width,height:_height,url:_url,skin:"layui-layer-gray",btn:["关闭"],yes:function(index,layero){layer.close(index)}};opt.modal.openOptions(options)},detailUrl:function(id){var url="/404.html";if(opt.common.isNotEmpty(id)){url=opt.table.options.detailUrl.replace("{id}",id)}else{var id=opt.common.isEmpty(opt.table.options.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns(opt.table.options.uniqueId);if(id.length==0){opt.modal.alertWarning("请至少选择一条记录");return}url=opt.table.options.detailUrl.replace("{id}",id)}return url},del:function(id){opt.table.set();opt.modal.confirm("确定删除该条"+opt.table.options.modalName+"信息吗？",function(){var url=opt.common.isEmpty(id)?opt.table.options.delUrl:opt.table.options.delUrl.replace("{id}",id);if(opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){opt.operate.get(url)}else{var data={"ids":id};opt.operate.submit(url,"POST","json",data,"",true)}})},exe:function(id){opt.table.set();opt.modal.confirm("确定处理该条"+table.options.modalName+"信息吗？",function(){var url=opt.common.isEmpty(id)?table.options.exeUrl:table.options.exeUrl.replace("{id}",id);if(opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){opt.operate.get(url)}else{var data={"ids":id};opt.operate.submit(url,"POST","json",data)}})},delAll:function(){opt.table.set();var rows=opt.common.isEmpty(opt.table.options.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns(opt.table.options.uniqueId);if(rows.length==0){opt.modal.error("请至少选择一条记录");return}opt.modal.confirm("确认要删除选中的"+rows.length+"条数据吗?",function(){var url=opt.table.options.delUrl;var data={"ids":rows.join()};opt.operate.submit(url,"POST","json",data,"",true)})},clean:function(){opt.table.set();opt.modal.confirm("确定清空所有"+opt.table.options.modalName+"吗？",function(){var url=opt.table.options.cleanUrl;opt.operate.submit(url,"post","json","")})},add:function(id){opt.table.set();opt.modal.open("添加"+opt.table.options.modalName,opt.operate.addUrl(id))},exeDis:function(id,title){opt.table.set();opt.modal.open("处理["+title+"]",opt.operate.exeUrl(id))},addTab:function(id){opt.table.set();opt.modal.openTab("添加"+opt.table.options.modalName,opt.operate.addUrl(id))},addFull:function(id){opt.table.set();var url=opt.common.isEmpty(id)?opt.table.options.addUrl:opt.table.options.addUrl.replace("{id}",id);opt.modal.openFull("添加"+opt.table.options.modalName,url)},addUrl:function(id){opt.table.set();var url=opt.common.isEmpty(id)?opt.table.options.addUrl.replace("{id}",""):opt.table.options.addUrl.replace("{id}",id);return url},exeUrl:function(id){opt.table.set();var url=opt.common.isEmpty(id)?opt.table.options.exeUrl.replace("{id}",""):opt.table.options.exeUrl.replace("{id}",id);return url},edit:function(id){opt.table.set();if(opt.common.isEmpty(opt.table.options.editUrl)){opt.modal.msgError("editUrl 未传!");return}if(opt.common.isEmpty(id)&&opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){var row=$("#"+opt.table.options.id).bootstrapTreeTable("getSelections")[0];if(opt.common.isEmpty(row)){opt.modal.error("请至少选择一条记录");return}var url=opt.table.options.editUrl.replace("{id}",row[opt.table.options.uniqueId]);opt.modal.open("修改"+opt.table.options.modalName,url)}else{opt.modal.open("修改"+opt.table.options.modalName,opt.operate.editUrl(id))}},editTab:function(id){opt.table.set();if(opt.common.isEmpty(opt.table.options.editUrl)){opt.modal.msgError("editUrl 未传!");return}if(opt.common.isEmpty(id)&&opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){var row=$("#"+opt.table.options.id).bootstrapTreeTable("getSelections")[0];if(opt.common.isEmpty(row)){opt.modal.error("请至少选择一条记录");return}var url=opt.table.options.editUrl.replace("{id}",row[opt.table.options.uniqueId]);opt.modal.openTab("修改"+opt.table.options.modalName,opt.operate.editUrl(id))}else{opt.modal.openTab("修改"+opt.table.options.modalName,opt.operate.editUrl(id))}},editFull:function(id){opt.table.set();var url="/404.html";if(opt.common.isNotEmpty(id)){url=opt.table.options.editUrl.replace("{id}",id)}else{var row=opt.common.isEmpty(opt.table.options.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns(opt.table.options.uniqueId);url=opt.table.options.editUrl.replace("{id}",row)}opt.modal.openFull("修改"+opt.table.options.modalName,url)},editUrl:function(id){opt.table.set();var url="/404.html";if(opt.common.isNotEmpty(id)){url=opt.table.options.editUrl.replace("{id}",id)}else{var id=opt.common.isEmpty(opt.table.options.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns(opt.table.options.uniqueId);if(id.length==0){opt.modal.error("请至少选择一条记录");
return}url=opt.table.options.editUrl.replace("{id}",id)}return url},save:function(url,data,callback){var config={url:url,type:"post",dataType:"json",data:data,beforeSend:function(){opt.modal.disable();opt.modal.loading($.i18n.prop("数据加载中，请稍后..."))},success:function(result){if(typeof callback=="function"){opt.modal.closeLoading();callback(result)}else{opt.operate.successCallback(result)}}};$.ajax(config)},saveModal:function(url,data,callback){var config={url:url,type:"post",dataType:"json",data:data,beforeSend:function(){opt.modal.loading($.i18n.prop("数据加载中，请稍后..."))},success:function(result){opt.modal.closeLoading();if(typeof callback=="function"){callback(result);return}if(result.code==opt.variable.web_status.SUCCESS){opt.modal.success($.i18n.prop("操作成功!"))}else{if(result.code==opt.variable.web_status.WARNING){opt.modal.warning(result.msg)}else{opt.modal.error(result.msg)}}}};$.ajax(config)},saveTab:function(url,data,callback){var config={url:url,type:"POST",dataType:"JSON",data:data,beforeSend:function(){opt.modal.loading($.i18n.prop("数据加载中，请稍后..."))},success:function(result){if(typeof callback=="function"){opt.modal.closeLoading();callback(result)}else{opt.operate.successTabCallback(result)}}};$.ajax(config)},ajaxSuccess:function(result){if(result.code==opt.variable.web_status.SUCCESS&&opt.table.options.type==opt.variable.table_type.bootstrapTable){opt.success($.i18n.prop("操作成功!"));$.table.refresh()}else{if(result.code==opt.variable.web_status.SUCCESS&&opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){opt.success($.i18n.prop("操作成功!"));$.treeTable.refresh()}else{if(result.code==opt.variable.web_status.WARNING){opt.modal.warning(result.msg)}else{opt.modal.error(result.msg)}}}opt.modal.closeLoading()},saveSuccess:function(result){if(result.code==opt.variable.web_status.SUCCESS){opt.modal.msgReload("保存成功,正在刷新数据请稍后……",opt.variable.modal_status.SUCCESS)}else{if(result.code==opt.variable.web_status.WARNING){opt.modal.alertWarning(result.msg)}else{opt.modal.alertError(result.msg)}}opt.modal.closeLoading()},successCallback:function(result){opt.modal.closeLoading();if(result.code==opt.variable.web_status.SUCCESS){var parent=window.parent;if(parent.opt.table.options.type==opt.variable.table_type.bootstrapTable){parent.$.table.refresh();parent.opt.success("操作成功",parent.opt.modal.closeAll())}else{if(parent.opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){parent.$.treeTable.refresh();parent.opt.success("操作成功",parent.opt.modal.closeAll())}else{if(window.opt.table.options.type==opt.variable.table_type.bootstrapTable){window.$.table.refresh();window.opt.success("操作成功",parent.opt.modal.closeAll())}else{opt.modal.msgReload("保存成功,正在刷新数据请稍后……",opt.variable.modal_status.SUCCESS)}}}}else{if(result.code==opt.variable.web_status.WARNING){opt.modal.warning(result.msg)}else{opt.modal.error(result.msg)}}},successTabCallback:function(result){opt.modal.closeLoading();if(top.location!=self.location){if(result.code==opt.variable.web_status.SUCCESS){var topWindow=$(window.parent.document);var currentId=$(".layui-tab-title",topWindow).find(".layui-this").children("em").attr("panel-id");if(opt.common.isNotEmpty(currentId)){var $contentWindow=$('iframe[data-id="'+currentId+'"]',topWindow)[0].contentWindow;$contentWindow.opt.success($.i18n.prop("操作成功!"))}else{parent.opt.success($.i18n.prop("操作成功!"))}opt.modal.closeTab()}else{if(result.code==opt.variable.web_status.WARNING){opt.modal.warning(result.msg)}else{opt.modal.error(result.msg)}}}else{opt.modal.closeTab()}},successTab:function(){if(top.location!=self.location){var topWindow=$(window.parent.document);var currentId=$(".layui-tab-title",topWindow).find(".layui-this").children("em").attr("panel-id");if(opt.common.isNotEmpty(currentId)){var $contentWindow=$('iframe[data-id="'+currentId+'"]',topWindow)[0].contentWindow;$contentWindow.opt.modal.msg($.i18n.prop("操作成功!"));if($contentWindow.opt.table.options.type==opt.variable.table_type.bootstrapTable){$contentWindow.$.table.refresh()}else{if($contentWindow.opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){$contentWindow.$.treeTable.refresh()}}}opt.modal.closeTab()}else{opt.modal.closeTab()}}},validate:{unique:function(o){var obj=$.parseJSON(o);if(obj.code===opt.variable.web_status.SUCCESS){return true}return false},form:function(formId){var currentId;if(opt.common.isEmpty(formId)){if(opt.common.isEmpty(opt.table.options.formId)){currentId=$("form").attr("id")}else{currentId=opt.table.options.formId}}else{currentId=formId}return $("#"+currentId).validate().form()},reset:function(formId){var currentId;if(opt.common.isEmpty(formId)){if(opt.common.isEmpty(opt.table.options.formId)){currentId=$("form").attr("id")}else{currentId=opt.table.options.formId}}else{currentId=formId}return $("#"+currentId).validate().resetForm()},fromData:function(formId){var currentId;if(opt.common.isEmpty(formId)){if(opt.common.isEmpty(opt.table.options.formId)){currentId=$("form").attr("id")}else{currentId=opt.table.options.formId
}}else{currentId=formId}return $("#"+currentId).serialize()}},form:{reset:function(formId,tableId,notName){opt.table.set(tableId);var currentId;if(opt.common.isEmpty(formId)){if(opt.common.isEmpty(opt.table.options.formId)){currentId=$("form").attr("id")}else{currentId=opt.table.options.formId}}else{currentId=formId}$("#"+currentId)[0].reset();$("#"+currentId+" select").each(function(i){if(!opt.common.isEmpty($(this).attr("data-select2-id"))){if(opt.common.isEmpty(notName)){$(this).val(null).trigger("change")}else{if(notName!=$(this).attr("name")){$(this).val(null).trigger("change")}}}});if(opt.table.options.type==opt.variable.table_type.bootstrapTable){if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){opt.table.rememberSelecteds={};opt.table.rememberSelectedIds={}}if(opt.common.isEmpty(tableId)){$("#"+opt.table.options.id).bootstrapTable("refresh")}else{$("#"+tableId).bootstrapTable("refresh")}}else{if(opt.table.options.type==opt.variable.table_type.bootstrapTreeTable){if(opt.common.isEmpty(tableId)){$("#"+opt.table.options.id).bootstrapTreeTable("refresh",[])}else{$("#"+tableId).bootstrapTreeTable("refresh",[])}}}},submit:function(){if(typeof submitHandler=="function"){opt.modal.disable();submitHandler();opt.modal.enable()}else{opt.modal.error($.i18n.prop("页面方法错误[submitHandler]"))}},selectCheckeds:function(name){var checkeds="";$('input:checkbox[name="'+name+'"]:checked').each(function(i){if(0==i){checkeds=$(this).val()}else{checkeds+=(","+$(this).val())}});return checkeds},selectSelects:function(name){var selects="";$("#"+name+" option:selected").each(function(i){if(0==i){selects=$(this).val()}else{selects+=(","+$(this).val())}});return selects.split(",")},getInputValue:function(name){return $('input[name="'+name+'"]').val()},dataUp:function(options){var defaults={id:"form-user-saveUpdate",del:[],conversion:[]};var options=$.extend(defaults,options);var data=$("#"+options.id).serializeArray();for(var i=0;i<data.length;i++){if(opt.common.isEmpty(options.del)){break}for(var k=0;k<options.del.length;k++){if(data[i].name==options.del[k]){data.splice(i,1);if(i==0){i=0}else{i--}}}}for(var i=0;i<data.length;i++){if(opt.common.isEmpty(options.conversion)){break}for(var k=0;k<options.conversion.length;k++){if(data[i].name==options.conversion[k].name){if(options.conversion[k].value=="arr"){data[i].value=data[i].value.split(",")}if(options.conversion[k].value=="num"){data[i].value=Number(data[i].value)}}}}return data}},};$(function(){$('[data-toggle="tooltip"]').each(function(){$(this).tooltip()});setTimeout(function(){$('[data-index="_new"]').each(function(){$(this).addClass("jump5")})},2000);if($.fn.select2!==undefined){$.fn.select2.defaults.set("theme","bootstrap");$("select.form-control:not(.noselect2)").each(function(){$(this).select2().on("change",function(){$(this).valid()})})}if($.fn.iCheck!==undefined){$(".check-box:not(.noicheck),.radio-box:not(.noicheck)").each(function(){$(this).iCheck({checkboxClass:(typeof($(this).data("style"))=="undefined")?"icheckbox-blue":("icheckbox_"+($(this).data("style")||"square-blue")),radioClass:(typeof($(this).data("style"))=="undefined")?"iradio-blue":("iradio_"+($(this).data("style")||"square-blue"))})})}$('[data-toggle="popover"]').each(function(){$(this).popover()});if($(".select-time").length>0){layui.use("laydate",function(){var laydate=layui.laydate;var startDate=laydate.render({elem:"#startTime",max:$("#endTime").val(),theme:"default",type:$("#startTime").attr("data-type")||"date",trigger:"click",done:function(value,date){if(value!==""){endDate.config.min.year=date.year;endDate.config.min.month=date.month-1;endDate.config.min.date=date.date}else{endDate.config.min.year="";endDate.config.min.month="";endDate.config.min.date=""}}});var endDate=laydate.render({elem:"#endTime",min:$("#startTime").val(),theme:"default",type:$("#endTime").attr("data-type")||"date",trigger:"click",done:function(value,date){if(value!==""){startDate.config.max.year=date.year;startDate.config.max.month=date.month-1;startDate.config.max.date=date.date}else{startDate.config.max.year="2099";startDate.config.max.month="12";startDate.config.max.date="31"}}})})}if($(".time-input").length>0){layui.use("laydate",function(){var com=layui.laydate;$(".time-input").each(function(index,item){var time=$(item);var type=time.attr("data-type")||"date";var format=time.attr("data-format")||"yyyy-MM-dd";var buttons=time.attr("data-btn")||"clear|now|confirm",newBtnArr=[];var callback=time.attr("data-callback")||{};if(buttons){if(buttons.indexOf("|")>0){var btnArr=buttons.split("|"),btnLen=btnArr.length;for(var j=0;j<btnLen;j++){if("clear"===btnArr[j]||"now"===btnArr[j]||"confirm"===btnArr[j]){newBtnArr.push(btnArr[j])}}}else{if("clear"===buttons||"now"===buttons||"confirm"===buttons){newBtnArr.push(buttons)}}}else{newBtnArr=["clear","now","confirm"]}com.render({elem:item,theme:"molv",trigger:"click",type:type,format:format,btns:newBtnArr,done:function(value,data){if(typeof window[callback]!="undefined"&&window[callback] instanceof Function){window[callback](value,data)
}}})})})}var expandFlag;$("#expandAllBtn").click(function(){var dataExpand=opt.common.isEmpty(opt.table.options.expandAll)?true:opt.table.options.expandAll;expandFlag=opt.common.isEmpty(expandFlag)?dataExpand:expandFlag;if(!expandFlag){$.bttTable.bootstrapTreeTable("expandAll")}else{$.bttTable.bootstrapTreeTable("collapseAll")}expandFlag=expandFlag?false:true});if($("#keyword").length>0){$("#keyword").bind("focus",function focusKey(e){if($("#keyword").hasClass("empty")){$("#keyword").removeClass("empty")}}).bind("blur",function blurKey(e){if($("#keyword").val()===""){$("#keyword").addClass("empty")}$.tree.searchNode(e)}).bind("input propertychange",$.tree.searchNode)}var icon="<i class='fa fa-times-circle'></i>  ";if(opt.common.isNotEmpty($.validator.messages)){opt.common.extend($.validator.messages,{required:icon+$.i18n.prop("必填"),remote:icon+$.i18n.prop("sys.msg.remote"),email:icon+$.i18n.prop("sys.msg.email"),url:icon+$.i18n.prop("sys.msg.url"),date:icon+$.i18n.prop("sys.msg.date"),dateISO:icon+$.i18n.prop("sys.msg.dateISO"),number:icon+$.i18n.prop("sys.msg.number"),digits:icon+$.i18n.prop("sys.msg.digits"),creditcard:icon+$.i18n.prop("sys.msg.creditcard"),equalTo:icon+$.i18n.prop("sys.msg.equalTo"),extension:icon+$.i18n.prop("sys.msg.extension"),maxlength:$.validator.format(icon+$.i18n.prop("sys.msg.maxlength")),minlength:$.validator.format(icon+$.i18n.prop("sys.msg.minlength")),rangelength:$.validator.format(icon+$.i18n.prop("sys.msg.rangelength")),range:$.validator.format(icon+$.i18n.prop("sys.msg.range")),max:$.validator.format(icon+$.i18n.prop("sys.msg.max")),min:$.validator.format(icon+$.i18n.prop("sys.msg.min"))})}$("body",document).on("keyup",this,function(e){if(e.which===27){opt.modal.closeAll()}});$("#scroll-up").toTop()});window.opt=opt})(window.jQuery,window);(function($){$.fn.toTop=function(opt){var elem=this;var win=$(window);var doc=$("html, body");var options=$.extend({autohide:true,offset:50,speed:500,position:true,right:15,bottom:5},opt);elem.css({"cursor":"pointer"});if(options.autohide){elem.css("display","none")}if(options.position){elem.css({"position":"fixed","right":options.right,"bottom":options.bottom,})}elem.click(function(){doc.animate({scrollTop:0},options.speed)});win.scroll(function(){var scrolling=win.scrollTop();if(options.autohide){if(scrolling>options.offset){elem.fadeIn(options.speed)}else{elem.fadeOut(options.speed)}}})}}(jQuery));(function($){$.extend({table:{init:function(options){var defaults={formId:"",id:"bootstrap-table",type:0,height:undefined,sidePagination:"server",sortName:"",sortOrder:"asc",pagination:true,pageSize:50,pageList:[50,100,150],toolbar:"toolbar",striped:false,escape:false,outcheckbox:true,firstLoad:true,showFooter:false,undefinedText:"/",emptyText:"/",search:false,showSearch:true,showPageGo:true,showRefresh:true,showColumns:true,showToggle:true,showExport:false,clickToSelect:true,singleSelect:false,paginationLoop:true,showPage:true,mobileResponsive:true,rememberSelected:true,_total:false,showPaginationSwitch:false,fixedColumns:false,fixedNumber:0,rightFixedColumns:false,rightFixedNumber:0,queryParams:$.table.queryParams,totalData:undefined,_totalColumns:[],rowStyle:{},};var options=$.extend(defaults,options);if(options.outcheckbox&&(!opt.common.isEmpty($("#"+options.toolbar+" .multiple").html())||!opt.common.isEmpty($("#"+options.toolbar+" .single").html()))){var _flag=false;if(!opt.common.isEmpty(options.columns.length)){for(var i=0;i<options.columns.length;i++){if(!opt.common.isEmpty(opt.common.getJsonValue(options.columns[i],"checkbox"))){_flag=true;break}}}if(!_flag){options.columns.splice(0,0,{checkbox:true,field:"state"})}}if(!opt.common.isEmpty(options.columns.length)){for(var i=0;i<options.columns.length;i++){if(opt.common.isEmpty(opt.common.getJsonValue(options.columns[i],"align"))){options.columns[i].align="center"}if(opt.common.isEmpty(opt.common.getJsonValue(options.columns[i],"halign"))){options.columns[i].halign="center"}}}opt.table.options=options;opt.table.config[options.id]=options;$.table.initEvent();$("#"+options.id).bootstrapTable({url:options.url,contentType:"application/x-www-form-urlencoded",method:"post",cache:false,height:options.height,striped:options.striped,sortable:true,sortStable:true,sortName:options.sortName,sortOrder:options.sortOrder,pagination:options.pagination,paginationLoop:options.paginationLoop,undefinedText:options.undefinedText,emptyText:options.emptyText,showPaginationSwitch:options.showPaginationSwitch,pageNumber:1,pageSize:options.pageSize,pageList:options.pageList,firstLoad:options.firstLoad,escape:options.escape,showFooter:options.showFooter,iconSize:"outline",toolbar:"#"+options.toolbar,sidePagination:options.sidePagination,search:options.search,searchText:options.searchText,showSearch:options.showSearch,showPageGo:options.showPageGo,showPage:options.showPage,showRefresh:options.showRefresh,showColumns:options.showColumns,showToggle:options.showToggle,showExport:options.showExport,uniqueId:options.uniqueId,clickToSelect:options.clickToSelect,singleSelect:options.singleSelect,mobileResponsive:options.mobileResponsive,detailView:options.detailView,onClickRow:options.onClickRow,onDblClickRow:options.onDblClickRow,onClickCell:options.onClickCell,onDblClickCell:options.onDblClickCell,onEditableSave:options.onEditableSave,onExpandRow:options.onExpandRow,rememberSelected:options.rememberSelected,fixedColumns:options.fixedColumns,fixedNumber:options.fixedNumber,rightFixedColumns:options.rightFixedColumns,rightFixedNumber:options.rightFixedNumber,onReorderRow:options.onReorderRow,queryParams:options.queryParams,rowStyle:options.rowStyle,columns:options.columns,responseHandler:$.table.responseHandler,onLoadSuccess:$.table.onLoadSuccess,exportOptions:options.exportOptions,detailFormatter:options.detailFormatter,})
},getOptionsIds:function(separator){var _separator=opt.common.isEmpty(separator)?",":separator;var optionsIds="";$.each(opt.table.config,function(key,value){optionsIds+="#"+key+_separator});return optionsIds.substring(0,optionsIds.length-1)},queryParams:function(params){var curParams={limit:params.limit,page:params.offset/params.limit+1,searchValue:params.search,sidx:params.sort,order:params.order};var currentId=opt.common.isEmpty(opt.table.options.formId)?$("form").attr("id"):opt.table.options.formId;return $.extend(curParams,opt.common.formToJSON(currentId))},tableTotalHtml:function(id){opt.table.set();var _v="";if(!opt.common.isEmpty(opt.table.options.totalData)){return"<span>"+opt.common.getJsonValue(opt.table.options.totalData,id)+"</span>"}else{return""}},responseHandler:function(res){if(typeof opt.table.options.responseHandler=="function"){opt.table.options.responseHandler(res)}if(res.code==0){if(opt.common.isNotEmpty(opt.table.options.sidePagination)&&opt.table.options.sidePagination=="client"){return res.rows}else{if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){var column=opt.common.isEmpty(opt.table.options.uniqueId)?opt.table.options.columns[1].field:opt.table.options.uniqueId;$.each(res.data.list,function(i,row){if(opt.table.rememberSelectedIds[opt.table.options.id]){var _flag=false;for(var i=0;i<opt.table.rememberSelectedIds[opt.table.options.id].length;i++){if(row[column]==opt.table.rememberSelectedIds[opt.table.options.id][i]){_flag=true}}row.state=_flag}else{row.state=false}})}if(opt.common.isNotEmpty(opt.table.options._total)&&opt.table.options._total){opt.table.options.totalData=res.pageTotal}return{rows:res.data.list,total:res.data.totalCount}}}else{opt.modal.error(res.msg,function(){try{opt.closeItem()}catch(e){}});return{rows:[],total:0}}},initEvent:function(){var optionsIds=$.table.getOptionsIds();$(optionsIds).on(TABLE_EVENTS,function(){opt.table.set($(this).attr("id"))});$(optionsIds).on("check.bs.table check-all.bs.table uncheck.bs.table uncheck-all.bs.table",function(e,rows){var rowIds=$.table.affectedRowIds(rows);if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){var _trows=$.map($("#"+opt.table.options.id).bootstrapTable("getAllSelections"),function(row){return row});var selectedIds=opt.table.rememberSelectedIds[opt.table.options.id];var selectedRows=opt.table.rememberSelecteds[opt.table.options.id];if(opt.common.isEmpty(selectedIds)&&opt.common.isEmpty(selectedIds)&&_trows.length>1){opt.table.rememberSelecteds[opt.table.options.id]=_["union"]([],_trows,opt.table.options.uniqueId);opt.table.rememberSelectedIds[opt.table.options.id]=_["union"]([],$.table.affectedRowIds(_trows),opt.table.options.uniqueId)}var column=opt.common.isEmpty(opt.table.options.uniqueId)?opt.table.options.columns[1].field:opt.table.options.uniqueId;func=$.inArray(e.type,["check","check-all"])>-1?"union":"difference";selectedIds=opt.table.rememberSelectedIds[opt.table.options.id];if(opt.common.isNotEmpty(selectedIds)){opt.table.rememberSelectedIds[opt.table.options.id]=_[func](selectedIds,rowIds,column)}else{opt.table.rememberSelectedIds[opt.table.options.id]=_[func]([],rowIds,column)}selectedRows=opt.table.rememberSelecteds[opt.table.options.id];if(opt.common.isNotEmpty(selectedRows)){opt.table.rememberSelecteds[opt.table.options.id]=_[func](selectedRows,rows,column)}else{opt.table.rememberSelecteds[opt.table.options.id]=_[func]([],rows,column)}}});$(optionsIds).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table load-success.bs.table",function(){var toolbar=opt.table.options.toolbar;var uniqueId=opt.table.options.uniqueId;var rows=opt.common.isEmpty(uniqueId)?$.table.selectFirstColumns():$.table.selectColumns(uniqueId);$("#"+toolbar+" .multiple").toggleClass("disabled",!rows.length);$("#"+toolbar+" .single").toggleClass("disabled",rows.length!=1)});$(optionsIds).off("click").on("click",".img-circle",function(){var src=$(this).attr("src");var target=$(this).data("target");var height=$(this).data("height");var width=$(this).data("width");if(opt.common.equals("self",target)){layer.open({title:false,type:1,closeBtn:true,shadeClose:true,area:["auto","auto"],content:"<img src='"+src+"' height='"+height+"' width='"+width+"'/>"})}else{if(opt.common.equals("blank",target)){window.open(src)}}});$(optionsIds).on("click",".tooltip-show",function(){var target=$(this).data("target");var input=$(this).prev();if(opt.common.equals("copy",target)){input.select();document.execCommand("copy")}else{if(opt.common.equals("open",target)){opt.selfLayer.alert(input.val(),{title:"信息内容",shadeClose:true,btn:["确认"],btnclass:["btn btn-primary"],})}}})},onLoadSuccess:function(data){if(typeof opt.table.options.onLoadSuccess=="function"){opt.table.options.onLoadSuccess(data)}$("[data-toggle='tooltip']").tooltip();if(opt.common.isNotEmpty(opt.table.options._total)&&opt.table.options._total){var _p="汇总:&nbsp;&nbsp;";for(var i=0;
i<opt.table.options._totalColumns.length;i++){_p+=opt.table.options._totalColumns[i].title;_p+=":";_p+=opt.common.isEmpty(opt.common.getJsonValue(opt.table.options.totalData,opt.table.options._totalColumns[i].field))?"0.00":opt.common.getJsonValue(opt.table.options.totalData,opt.table.options._totalColumns[i].field)+"&nbsp;&nbsp;"}$("#_pageTotal").html(_p)}$('[data-toggle="popover"]').popover();if($.fn.iCheck!==undefined){$(".check-box:not(.noicheck),.radio-box:not(.noicheck)").each(function(){$(this).iCheck({checkboxClass:(typeof($(this).data("style"))=="undefined")?"icheckbox-blue":("icheckbox_"+($(this).data("style")||"square-blue")),radioClass:(typeof($(this).data("style"))=="undefined")?"iradio-blue":("iradio_"+($(this).data("style")||"square-blue"))})})}if($.fn.select2!==undefined){$.fn.select2.defaults.set("theme","bootstrap");$("select.form-control:not(.noselect2)").each(function(){$(this).select2().on("change",function(){$(this).valid()})})}$(window).on("resize",function(){$("[data-toggle='tooltip']").tooltip();$('[data-toggle="popover"]').popover();if($.fn.iCheck!==undefined){$(".check-box:not(.noicheck),.radio-box:not(.noicheck)").each(function(){$(this).iCheck({checkboxClass:(typeof($(this).data("style"))=="undefined")?"icheckbox-blue":("icheckbox_"+($(this).data("style")||"square-blue")),radioClass:(typeof($(this).data("style"))=="undefined")?"iradio-blue":("iradio_"+($(this).data("style")||"square-blue"))})})}if($.fn.select2!==undefined){$.fn.select2.defaults.set("theme","bootstrap");$("select.form-control:not(.noselect2)").each(function(){$(this).select2().on("change",function(){$(this).valid()})})}}).resize()},destroy:function(tableId){var currentId=opt.common.isEmpty(tableId)?opt.table.options.id:tableId;$("#"+currentId).bootstrapTable("destroy")},serialNumber:function(index,tableId){var currentId=opt.common.isEmpty(tableId)?opt.table.options.id:tableId;var tableParams=$("#"+currentId).bootstrapTable("getOptions");var pageSize=tableParams.pageSize;var pageNumber=tableParams.pageNumber;return pageSize*(pageNumber-1)+index+1},tooltip:function(value,length,align,target){var _length=opt.common.isEmpty(length)?20:length;var _align=opt.common.isEmpty(align)?false:align;var _text="";var _value=opt.common.nullToStr(value);var _target=opt.common.isEmpty(target)?"copy":target;if(_value.length>_length){if(_align){_text="..."+_value.substr(_value.length-_length,_length)}else{_text=_value.substr(0,_length)+"..."}_value=_value.replace(/\'/g,"&apos;");_value=_value.replace(/\"/g,"&quot;");var actions=[];actions.push(opt.common.sprintf('<input id="tooltip-show" style="opacity: 0;position: absolute;z-index:-1" type="text" value="%s"/>',_value));actions.push(opt.common.sprintf('<a href="###" class="tooltip-show" data-toggle="tooltip" data-target="%s" title="%s">%s</a>',_target,_value,_text));return actions.join("")}else{_text=_value;return _text}},dropdownToggle:function(value){var actions=[];actions.push('<div class="btn-group">');actions.push('<button type="button" class="btn btn-xs dropdown-toggle" data-toggle="dropdown" aria-expanded="false">');actions.push('<i class="fa fa-cog"></i>&nbsp;<span class="fa fa-chevron-down"></span></button>');actions.push('<ul class="dropdown-menu">');actions.push(value.replace(/<a/g,"<li><a").replace(/<\/a>/g,"</a></li>"));actions.push("</ul>");actions.push("</div>");return actions.join("")},imageView:function(value,height,width,target){if(opt.common.isEmpty(width)){width="auto"}if(opt.common.isEmpty(height)){height="auto"}var _target=opt.common.isEmpty(target)?"self":target;if(opt.common.isNotEmpty(value)){return opt.common.sprintf("<img class='img-circle img-xs' data-height='%s' data-width='%s' data-target='%s' src='%s'/>",height,width,_target,value)}else{return opt.common.nullToStr(value)}},search:function(formId,tableId,data){opt.table.set(tableId);opt.debug(formId);var currentId;if(opt.common.isEmpty(formId)){if(opt.common.isEmpty(opt.table.options.formId)){currentId=$("form").attr("id")}else{currentId=opt.table.options.formId}}else{currentId=formId}var params=opt.common.isEmpty(tableId)?$("#"+opt.table.options.id).bootstrapTable("getOptions"):$("#"+tableId).bootstrapTable("getOptions");params.queryParams=function(params){var search=opt.common.formToJSON(currentId);if(opt.common.isNotEmpty(data)){$.each(data,function(key){search[key]=data[key]})}search.limit=params.limit;search.page=params.offset/params.limit+1;search.searchValue=params.search;search.sidx=params.sort;search.order=params.order;return search};if(opt.common.isNotEmpty(tableId)){$("#"+tableId).bootstrapTable("refresh",params)}else{$("#"+opt.table.options.id).bootstrapTable("refresh",params)}},exportExcel:function(formId){opt.table.set();opt.modal.confirm("确定导出所有"+opt.table.options.modalName+"吗？",function(){var currentId=opt.common.isEmpty(formId)?$("form").attr("id"):formId;opt.modal.loading("正在导出数据，请稍后...");$.post(opt.table.options.exportUrl,$("#"+currentId).serializeArray(),function(result){if(result.code==opt.variable.web_status.SUCCESS){window.location.href=baseURL+"excel/download?fileName="+encodeURI(result.msg)
}else{if(result.code==opt.variable.web_status.WARNING){opt.modal.alertWarning(result.msg)}else{opt.modal.alertError(result.msg)}}opt.modal.closeLoading()})})},importTemplate:function(){table.set();$.get(table.options.importTemplateUrl,function(result){if(result.code==web_status.SUCCESS){window.location.href=ctx+"common/download?fileName="+encodeURI(result.msg)+"&delete="+true}else{if(result.code==web_status.WARNING){opt.modal.alertWarning(result.msg)}else{opt.modal.alertError(result.msg)}}})},importExcel:function(formId){table.set();var currentId=opt.common.isEmpty(formId)?"importTpl":formId;layer.open({type:1,area:["400px","230px"],fix:false,maxmin:true,shade:0.3,title:"导入"+table.options.modalName+"数据",content:$("#"+currentId).html(),btn:['<i class="fa fa-check"></i> 导入','<i class="fa fa-remove"></i> 取消'],shadeClose:true,btn1:function(index,layero){var file=layero.find("#file").val();if(file==""||(!opt.common.endWith(file,".xls")&&!opt.common.endWith(file,".xlsx"))){opt.modal.msgWarning("请选择后缀为 “xls”或“xlsx”的文件。");return false}var index=layer.load(2,{shade:false});opt.modal.disable();var formData=new FormData();formData.append("file",$("#file")[0].files[0]);formData.append("updateSupport",$("input[name='updateSupport']").is(":checked"));$.ajax({url:table.options.importUrl,data:formData,cache:false,contentType:false,processData:false,type:"POST",success:function(result){if(result.code==web_status.SUCCESS){opt.modal.closeAll();opt.modal.alertSuccess(result.msg);$.table.refresh()}else{if(result.code==web_status.WARNING){layer.close(index);opt.modal.enable();opt.modal.alertWarning(result.msg)}else{layer.close(index);opt.modal.enable();opt.modal.alertError(result.msg)}}}})}})},refresh:function(tableId){var currentId=opt.common.isEmpty(tableId)?opt.table.options.id:tableId;$("#"+currentId).bootstrapTable("refresh",{silent:true})},selectColumns:function(column){var rows=$.map($("#"+opt.table.options.id).bootstrapTable("getSelections"),function(row){return row[column]});if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){var selectedRows=opt.table.rememberSelecteds[opt.table.options.id];if(opt.common.isNotEmpty(selectedRows)){rows=$.map(opt.table.rememberSelecteds[opt.table.options.id],function(row){return row[column]})}}return opt.common.uniqueFn(rows)},affectedRowIds:function(rows){var column=opt.common.isEmpty(opt.table.options.uniqueId)?opt.table.options.columns[1].field:opt.table.options.uniqueId;var rowIds;if($.isArray(rows)){rowIds=$.map(rows,function(row){return row[column]})}else{rowIds=[rows[column]]}return rowIds},selectFirstColumns:function(){var rows=$.map($("#"+opt.table.options.id).bootstrapTable("getSelections"),function(row){return row[opt.table.options.columns[1].field]});if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){var selectedRows=opt.table.rememberSelecteds[opt.table.options.id];if(opt.common.isNotEmpty(selectedRows)){rows=$.map(selectedRows,function(row){return row[opt.table.options.columns[1].field]})}}return opt.common.uniqueFn(rows)},selectAllColumns:function(){var rows;if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){var selectedRows=opt.table.rememberSelecteds[opt.table.options.id];if(opt.common.isNotEmpty(selectedRows)){rows=$.map(selectedRows,function(row){return row[opt.table.options.uniqueId]})}else{rows=[]}}if(opt.common.isEmpty(rows)||rows.length==0){rows=$.map($("#"+opt.table.options.id).bootstrapTable("getAllSelections"),function(row){return row});if(opt.common.isNotEmpty(opt.table.options.rememberSelected)&&opt.table.options.rememberSelected){opt.table.rememberSelecteds[opt.table.options.id]=_["union"]([],rows,opt.table.options.uniqueId);opt.table.rememberSelectedIds[opt.table.options.id]=_["union"]([],$.table.affectedRowIds(rows),opt.table.options.uniqueId)}rows=$.table.affectedRowIds(rows)}opt.debug(rows);return opt.common.uniqueFn(rows)},selectDictLabel:function(datas,value){var actions=[];$.each(datas,function(index,dict){if(dict.dictValue==(""+value)){var listClass=opt.common.equals("default",dict.listClass)||opt.common.isEmpty(dict.listClass)?"":"badge badge-"+dict.listClass;if(!opt.common.isEmpty(dict.cssClass)){listClass=opt.common.isEmpty(dict.cssClass)?"":dict.cssClass}actions.push(opt.common.sprintf("<span class='%s'>%s</span>",listClass,$.i18n.prop(dict.dictLabel)));return false}if(opt.common.isEmpty(value)&&dict.isDefault==="Y"){var listClass=opt.common.equals("default",dict.listClass)||opt.common.isEmpty(dict.listClass)?"":"badge badge-"+dict.listClass;if(!opt.common.isEmpty(dict.cssClass)){listClass=opt.common.isEmpty(dict.cssClass)?"":dict.cssClass}actions.push(opt.common.sprintf("<span class='%s'>%s</span>",listClass,$.i18n.prop(dict.dictLabel)));return false}});return actions.join("")},selectDictLabels:function(datas,valueStr){var actions=[];valueStr=valueStr||"";var values=valueStr.split(",");$.each(values,function(index,value){$.each(datas,function(index,dict){if(dict.dictValue==(""+value)){var listClass=opt.common.equals("default",dict.listClass)||opt.common.isEmpty(dict.listClass)?"":"badge badge-"+dict.listClass;
if(!opt.common.isEmpty(dict.cssClass)){listClass=opt.common.isEmpty(dict.cssClass)?"":dict.cssClass}actions.push(opt.common.sprintf("<span class='%s'>%s</span>",listClass,$.i18n.prop(dict.dictLabel)));return false}if(opt.common.isEmpty(value)&&dict.isDefault==="Y"){var listClass=opt.common.equals("default",dict.listClass)||opt.common.isEmpty(dict.listClass)?"":"badge badge-"+dict.listClass;if(!opt.common.isEmpty(dict.cssClass)){listClass=opt.common.isEmpty(dict.cssClass)?"":dict.cssClass}actions.push(opt.common.sprintf("<span class='%s'>%s</span>",listClass,$.i18n.prop(dict.dictLabel)));return false}})});return actions.join(",")},showColumn:function(column,tableId){var currentId=opt.common.isEmpty(tableId)?table.options.id:tableId;$("#"+currentId).bootstrapTable("showColumn",column)},hideColumn:function(column,tableId){var currentId=opt.common.isEmpty(tableId)?table.options.id:tableId;$("#"+currentId).bootstrapTable("hideColumn",column)}}})})(jQuery);(function($){$.extend({bttTable:{},treeTable:{init:function(options){var defaults={id:"bootstrap-tree-table",type:1,height:0,rootIdValue:null,ajaxParams:{},toolbar:"toolbar",striped:false,expandColumn:1,showSearch:true,showRefresh:true,showColumns:true,expandAll:true,expandFirst:true};var options=$.extend(defaults,options);if(!opt.common.isEmpty(options.columns.length)){for(var i=0;i<options.columns.length;i++){if(opt.common.isEmpty(opt.common.getJsonValue(options.columns[i],"align"))){options.columns[i].align="center"}if(opt.common.isEmpty(opt.common.getJsonValue(options.columns[i],"halign"))){options.columns[i].halign="center"}}}opt.table.options=options;opt.table.config[options.id]=options;$.bttTable=$("#"+options.id).bootstrapTreeTable({code:options.code,parentCode:options.parentCode,type:"post",url:options.url,data:options.data,ajaxParams:options.ajaxParams,rootIdValue:options.rootIdValue,height:options.height,expandColumn:options.expandColumn,striped:options.striped,bordered:true,toolbar:"#"+options.toolbar,showSearch:options.showSearch,showRefresh:options.showRefresh,showColumns:options.showColumns,expandAll:options.expandAll,expandFirst:options.expandFirst,columns:options.columns,responseHandler:$.treeTable.responseHandler})},search:function(formId){var currentId=opt.common.isEmpty(formId)?$("form").attr("id"):formId;var params=opt.common.formToJSON(currentId);$.bttTable.bootstrapTreeTable("refresh",params)},refresh:function(){$.bttTable.bootstrapTreeTable("refresh")},selectColumns:function(column){var rows=$.map($.bttTable.bootstrapTreeTable("getSelections"),function(row){return row[column]});return opt.common.uniqueFn(rows)},responseHandler:function(data){if(data.code!=undefined&&data.code!=0){opt.modal.error(data.msg);return[]}else{return data}},}})})(jQuery);(function($){$.extend({_tree:{},tree:{_option:{},_lastValue:{},init:function(options){var defaults={id:"tree",expandLevel:0,view:{selectedMulti:false,nameIsHTML:true},check:{enable:false,nocheckInherit:true,},data:{key:{title:"name"},simpleData:{enable:true}},};var options=$.extend(defaults,options);$.tree._option=options;var setting={callback:{onClick:options.onClick,onCheck:options.onCheck,onDblClick:options.onDblClick,onCollapse:options.OnCollapse,onExpand:options.OnExpand,beforeClick:options.beforeClick},check:options.check,view:options.view,data:options.data};$.get(options.url,function(data){var list;if(data.__proto__.constructor==Array){list=data}else{if(data.code==opt.variable.web_status.SUCCESS){for(var key in data){if(Array.prototype==data[key].__proto__){list=data[key]}}for(var i=0;i<list.length;i++){for(var key in list[i]){if(key=="url"){delete list[i][key]}}}}else{opt.modal.error(data.msg);return}}var treeId=$("#treeId").val();tree=$.fn.zTree.init($("#"+options.id),setting,list);$._tree=tree;var nodes=tree.getNodesByParam("level",options.expandLevel-1);for(var i=0;i<nodes.length;i++){tree.expandNode(nodes[i],true,false,false)}if(options.check.enable){if(!opt.common.isEmpty(options._list)){var _l=options._list.split(",");for(var i=0;i<_l.length;i++){var node=tree.getNodeByParam(options.data.simpleData.idKey,_l[i]);if(node!=null){tree.checkNode(node,true)}}}if(!opt.common.isEmpty(treeId)){var node=tree.getNodeByParam(opt.common.isEmpty(options.data.simpleData.idKey)?"id":options.data.simpleData.idKey,treeId);if(!opt.common.isEmpty(node)){tree.checkNode(node,true);if($.tree._option.check.chkStyle=="radio"){tree.selectNode(node)}}}}if(!opt.common.isEmpty(treeId)&&!options.check.enable){var node=tree.getNodeByParam(opt.common.isEmpty(options.data.simpleData.idKey)?"id":options.data.simpleData.idKey,treeId);if(!opt.common.isEmpty(node)){tree.selectNode(node)}}if(typeof(options.callBack)==="function"){callBack($._tree)}})},expandAll:function(){$._tree.expandAll(true)},searchNode:function(){var value=opt.common.trim($("#keyword").val());if($.tree._lastValue==value){return}$.tree._lastValue=value;var nodes=$._tree.getNodes();if(value==""){$.tree.showAllNode(nodes);return}$.tree.hideAllNode(nodes);
$.tree.updateNodes($._tree.getNodesByParamFuzzy("name",value))},selectByIdName:function(treeId,node){if(opt.common.isNotEmpty(treeId)&&treeId==opt.common.getJsonValue(node,$.tree._option.data.simpleData.idKey)){$._tree.selectNode(node,true)}},showAllNode:function(nodes){nodes=$._tree.transformToArray(nodes);for(var i=nodes.length-1;i>=0;i--){if(nodes[i].getParentNode()!=null){$._tree.expandNode(nodes[i],true,false,false,false)}else{$._tree.expandNode(nodes[i],true,true,false,false)}$._tree.showNode(nodes[i]);$.tree.showAllNode(nodes[i].children)}},hideAllNode:function(nodes){var tree=$.fn.zTree.getZTreeObj("tree");var nodes=$._tree.transformToArray(nodes);for(var i=nodes.length-1;i>=0;i--){$._tree.hideNode(nodes[i])}},showParent:function(treeNode){var parentNode;while((parentNode=treeNode.getParentNode())!=null){$._tree.showNode(parentNode);$._tree.expandNode(parentNode,true,false,false);treeNode=parentNode}},showChildren:function(treeNode){if(treeNode.isParent){for(var idx in treeNode.children){var node=treeNode.children[idx];$._tree.showNode(node);$.tree.showChildren(node)}}},updateNodes:function(nodeList){$._tree.showNodes(nodeList);for(var i=0,l=nodeList.length;i<l;i++){var treeNode=nodeList[i];$.tree.showChildren(treeNode);$.tree.showParent(treeNode)}},refreshNode:function(){$._tree.reAsyncChildNodes(null,"refresh")},getCheckedNodes:function(column){var _column=opt.common.isEmpty(column)?(opt.common.isEmpty($.tree._option.data.simpleData.idKey)?"id":$.tree._option.data.simpleData.idKey):column;var nodes=$._tree.getCheckedNodes(true);var _t=$.map(nodes,function(row){return row[_column]}).join();return _t.split(",")},notAllowParents:function(_tree){return true},notAllowLastLevel:function(_tree){var nodes=_tree.getSelectedNodes();for(var i=0;i<nodes.length;i++){if(!nodes[i].isParent){$.modal.msgError("不能选择最后层级节点（"+nodes[i].name+"）");return false}}return true},toggleSearch:function(){$("#search").slideToggle(200);$("#btnShow").toggle();$("#btnHide").toggle();$("#keyword").focus()},collapse:function(){$._tree.expandAll(false)},expand:function(){$._tree.expandAll(true)},callBackTree:function(_p,_m){var tree=_p.find("iframe")[0].contentWindow.$._tree;if($.tree.notAllowParents(tree)){var body=layer.getChildFrame("body",_m);var treeId=body.find("#treeId").val();var treeName=body.find("#treeName").val();if(opt.common.isEmpty(treeName)){if(tree.setting.check.enable){var _l=treeId.split(",");for(var i=0;i<_l.length;i++){var node=tree.getNodeByParam(tree.setting.data.simpleData.idKey,_l[i]);if(node!=null){treeName+=node.name+","}}if(opt.common.isEmpty(treeName)){treeName=treeName.substr(0,treeName.length-1)}}else{treeName=tree.getNodesByParam(tree.setting.data.simpleData.idKey,treeId,null)[0].name}}var _n='{"id":"'+treeId+'","name":"'+treeName+'"}';return $.parseJSON(_n)}else{return false}}}})})(jQuery);+function(){var _lang=opt.getCookie("_lang");$.i18n.properties({path:baseURL+"i18n/",name:"i18n",language:_lang,cache:true,mode:"map"});var tmp=opt.storage.get("skin");if(tmp&&($.inArray(tmp,opt.variable.skins)>=0)){opt.changeSkin(tmp)}if(window.layer!==undefined){layer.config({extend:"moon/style.css",skin:"layer-ext-moon"})}$.ajaxSetup({complete:function(XMLHttpRequest,textStatus){if(textStatus=="timeout"){opt.outLogin("",$.i18n.prop("sys.login.out.error"));return}else{if(textStatus=="parsererror"||textStatus=="error"){opt.outLogin("",$.i18n.prop("sys.login.out.error"));return}}}})}();!function(){var config={open:"{{",close:"}}"};var tool={exp:function(str){return new RegExp(str,"g")},query:function(type,_,__){var types=["#([\\s\\S])+?","([^{#}])*?"][type||0];return exp((_||"")+config.open+types+config.close+(__||""))},escape:function(html){return String(html||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},error:function(e,tplog){var error="Laytpl Error：";typeof console==="object"&&console.error(error+e+"\n"+(tplog||""));return error+e}};var exp=tool.exp,Tpl=function(tpl){this.tpl=tpl};Tpl.pt=Tpl.prototype;window.errors=0;Tpl.pt.parse=function(tpl,data){var that=this,tplog=tpl;var jss=exp("^"+config.open+"#",""),jsse=exp(config.close+"$","");tpl=tpl.replace(/\s+|\r|\t|\n/g," ").replace(exp(config.open+"#"),config.open+"# ").replace(exp(config.close+"}"),"} "+config.close).replace(/\\/g,"\\\\").replace(exp(config.open+"!(.+?)!"+config.close),function(str){str=str.replace(exp("^"+config.open+"!"),"").replace(exp("!"+config.close),"").replace(exp(config.open+"|"+config.close),function(tag){return tag.replace(/(.)/g,"\\$1")});return str}).replace(/(?="|')/g,"\\").replace(tool.query(),function(str){str=str.replace(jss,"").replace(jsse,"");return'";'+str.replace(/\\/g,"")+';view+="'}).replace(tool.query(1),function(str){var start='"+(';if(str.replace(/\s/g,"")===config.open+config.close){return""}str=str.replace(exp(config.open+"|"+config.close),"");if(/^=/.test(str)){str=str.replace(/^=/,"");start='"+_escape_('}return start+str.replace(/\\/g,"")+')+"'
});tpl='"use strict";var view = "'+tpl+'";return view;';try{that.cache=tpl=new Function("d, _escape_",tpl);return tpl(data,tool.escape)}catch(e){delete that.cache;return tool.error(e,tplog)}};Tpl.pt.render=function(data,callback){var that=this,tpl;if(!data){return tool.error("no data")}tpl=that.cache?that.cache(data,tool.escape):that.parse(that.tpl,data);if(!callback){return tpl}callback(tpl)};var laytpl=function(tpl){if(typeof tpl!=="string"){return tool.error("Template not found")}return new Tpl(tpl)};laytpl.config=function(options){options=options||{};for(var i in options){config[i]=options[i]}};laytpl.v="1.2.0";"function"==typeof define?define(function(){return laytpl}):"undefined"!=typeof exports?module.exports=laytpl:window.laytpl=laytpl}();+function($){var DataKey="lte.boxwidget";var Default={animationSpeed:500,collapseTrigger:'[data-widget="collapse"]',removeTrigger:'[data-widget="remove"]',collapseIcon:"fa-minus",expandIcon:"fa-plus",removeIcon:"fa-times"};var Selector={data:".box",collapsed:".collapsed-box",header:".box-header",body:".box-body",footer:".box-footer",tools:".box-tools"};var ClassName={collapsed:"collapsed-box"};var Event={collapsing:"collapsing.boxwidget",collapsed:"collapsed.boxwidget",expanding:"expanding.boxwidget",expanded:"expanded.boxwidget",removing:"removing.boxwidget",removed:"removed.boxwidget"};var BoxWidget=function(element,options){this.element=element;this.options=options;this._setUpListeners()};BoxWidget.prototype.toggle=function(){var isOpen=!$(this.element).is(Selector.collapsed);if(isOpen){this.collapse()}else{this.expand()}};BoxWidget.prototype.expand=function(){var expandedEvent=$.Event(Event.expanded);var expandingEvent=$.Event(Event.expanding);var collapseIcon=this.options.collapseIcon;var expandIcon=this.options.expandIcon;$(this.element).removeClass(ClassName.collapsed);$(this.element).children(Selector.header+", "+Selector.body+", "+Selector.footer).children(Selector.tools).find("."+expandIcon).removeClass(expandIcon).addClass(collapseIcon);$(this.element).children(Selector.body+", "+Selector.footer).slideDown(this.options.animationSpeed,function(){$(this.element).trigger(expandedEvent)}.bind(this)).trigger(expandingEvent)};BoxWidget.prototype.collapse=function(){var collapsedEvent=$.Event(Event.collapsed);var collapsingEvent=$.Event(Event.collapsing);var collapseIcon=this.options.collapseIcon;var expandIcon=this.options.expandIcon;$(this.element).children(Selector.header+", "+Selector.body+", "+Selector.footer).children(Selector.tools).find("."+collapseIcon).removeClass(collapseIcon).addClass(expandIcon);$(this.element).children(Selector.body+", "+Selector.footer).slideUp(this.options.animationSpeed,function(){$(this.element).addClass(ClassName.collapsed);$(this.element).trigger(collapsedEvent)}.bind(this)).trigger(expandingEvent)};BoxWidget.prototype.remove=function(){var removedEvent=$.Event(Event.removed);var removingEvent=$.Event(Event.removing);$(this.element).slideUp(this.options.animationSpeed,function(){$(this.element).trigger(removedEvent);$(this.element).remove()}.bind(this)).trigger(removingEvent)};BoxWidget.prototype._setUpListeners=function(){var that=this;$(this.element).on("click",this.options.collapseTrigger,function(event){if(event){event.preventDefault()}that.toggle($(this));return false});$(this.element).on("click",this.options.removeTrigger,function(event){if(event){event.preventDefault()}that.remove($(this));return false})};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data(DataKey);if(!data){var options=$.extend({},Default,$this.data(),typeof option=="object"&&option);$this.data(DataKey,(data=new BoxWidget($this,options)))}if(typeof option=="string"){if(typeof data[option]=="undefined"){throw new Error("No method named "+option)}data[option]()}})}var old=$.fn.boxWidget;$.fn.boxWidget=Plugin;$.fn.boxWidget.Constructor=BoxWidget;$.fn.boxWidget.noConflict=function(){$.fn.boxWidget=old;return this};$(window).on("load",function(){$(Selector.data).each(function(){Plugin.call($(this))})})}(jQuery);